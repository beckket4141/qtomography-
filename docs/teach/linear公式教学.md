# LinearReconstructor ç¨‹åºä¸­çš„æ•°å­¦ä¸ç‰©ç†å…¬å¼è®²è§£

> ä»¥ä¸‹å†…å®¹æŒ‰ **æ¦‚å¿µ â†’ å…¬å¼ â†’ ç‰©ç†æ„ä¹‰ â†’ ä»£ç å¯¹åº”ä½ç½®** é¡ºåºè®²è§£ï¼Œå¸®åŠ©ä½ æŠŠç¨‹åºèƒŒåçš„é‡å­åŠ›å­¦é€»è¾‘å®Œå…¨åƒé€ã€‚

---

## ğŸ”¬ ä¸€ã€é‡å­æ€å±‚æçš„åŸºæœ¬å®šä¹‰ä¸ç‰©ç†æ¡ä»¶

### 1. å®šä¹‰

åœ¨é‡å­åŠ›å­¦ä¸­ï¼Œ**é‡å­æ€å±‚æ (Quantum State Tomography)** æ˜¯é€šè¿‡ä¸€ç³»åˆ—æµ‹é‡æ¥é‡æ„æœªçŸ¥é‡å­æ€çš„è¿‡ç¨‹ã€‚

å¯¹äºä¸€ä¸ª $n$ ç»´é‡å­ç³»ç»Ÿï¼Œå…¶çŠ¶æ€ç”±**å¯†åº¦çŸ©é˜µ** $\rho \in \mathbb{C}^{n \times n}$ å®Œå…¨æè¿°ã€‚

---

### 2. æµ‹é‡è¿‡ç¨‹çš„æ•°å­¦æè¿°

#### æŠ•å½±æµ‹é‡ (Projective Measurement)

å½“æˆ‘ä»¬ç”¨æŠ•å½±ç®—ç¬¦ $E_i$ æµ‹é‡é‡å­æ€ $\rho$ æ—¶ï¼Œå¾—åˆ°ç»“æœ $i$ çš„æ¦‚ç‡ä¸ºï¼š

$$
p_i = \mathrm{Tr}(E_i \rho)
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- $E_i$ï¼šç¬¬ $i$ ä¸ªæµ‹é‡åŸºå¯¹åº”çš„æŠ•å½±ç®—ç¬¦ $E_i = |\psi_i\rangle\langle\psi_i|$
- $\rho$ï¼šå¾…æµ‹é‡çš„å¯†åº¦çŸ©é˜µ
- $p_i$ï¼šæµ‹é‡åˆ°ç¬¬ $i$ ä¸ªç»“æœçš„æ¦‚ç‡
- $\mathrm{Tr}(\cdot)$ï¼šçŸ©é˜µçš„è¿¹ï¼ˆå¯¹è§’å…ƒç´ ä¹‹å’Œï¼‰

**ä»£ç å¯¹åº”**ï¼š
- æŠ•å½±ç®—ç¬¦ç”± `ProjectorSet` ç”Ÿæˆ
- æ¦‚ç‡ $p_i$ æ˜¯å®éªŒæµ‹é‡æ•°æ®ï¼ˆå‡½æ•°è¾“å…¥ï¼‰
- é‡æ„ç›®æ ‡æ˜¯ä» $\{p_i\}$ åæ¨ $\rho$

---

### 3. å®Œå¤‡æµ‹é‡åŸºçš„æ¡ä»¶

ä¸ºäº†å”¯ä¸€ç¡®å®š $n$ ç»´ç³»ç»Ÿçš„å¯†åº¦çŸ©é˜µï¼ˆ$n^2$ ä¸ªå®è‡ªç”±åº¦ï¼‰ï¼Œéœ€è¦ $n^2$ ä¸ªçº¿æ€§ç‹¬ç«‹çš„æµ‹é‡ï¼š

$$
\sum_{i=1}^{n^2} E_i = n \cdot I
$$

å…¶ä¸­ $I$ æ˜¯å•ä½çŸ©é˜µã€‚

**ç‰©ç†æ„ä¹‰**ï¼š
- æµ‹é‡åŸºå¿…é¡»åœ¨å¸Œå°”ä¼¯ç‰¹ç©ºé—´ä¸­"å®Œå¤‡"
- ä¸èƒ½æœ‰å†—ä½™æˆ–é—æ¼çš„æµ‹é‡æ–¹å‘
- ç±»ä¼¼äºç”¨ $n^2$ ä¸ªæ–¹ç¨‹æ±‚è§£ $n^2$ ä¸ªæœªçŸ¥æ•°

**ä»£ç å¯¹åº”**ï¼š
- `ProjectorSet._build_bases()` ç”Ÿæˆå®Œå¤‡çš„æµ‹é‡åŸº
- æ ‡å‡†åŸº $n$ ä¸ª + ç»„åˆåŸº $\binom{n}{2}$ ä¸ª + ç›¸ä½åŸº $\binom{n}{2}$ ä¸ª = $n^2$ ä¸ª

---

## ğŸ§® äºŒã€çº¿æ€§é‡æ„çš„æ ¸å¿ƒæ–¹ç¨‹

### 1. ä»è¿¹å…¬å¼åˆ°çº¿æ€§æ–¹ç¨‹

#### å±•å¼€è¿¹è¿ç®—

$$
p_i = \mathrm{Tr}(E_i \rho) = \sum_{j=1}^{n} (E_i)_{jj} \rho_{jj} + \sum_{j \neq k} (E_i)_{jk} \rho_{jk}
$$

æ›´ç®€æ´çš„å†™æ³•ï¼ˆå°†çŸ©é˜µå±•å¹³ä¸ºå‘é‡ï¼‰ï¼š

$$
p_i = \sum_{j,k=1}^{n} (E_i)_{jk} \rho_{jk} = \langle \mathrm{vec}(E_i), \mathrm{vec}(\rho) \rangle
$$

å…¶ä¸­ $\mathrm{vec}(\cdot)$ è¡¨ç¤ºå°†çŸ©é˜µæŒ‰åˆ—ï¼ˆæˆ–è¡Œï¼‰å±•å¹³ä¸ºå‘é‡ã€‚

---

#### çŸ©é˜µå½¢å¼çš„çº¿æ€§æ–¹ç¨‹

å¯¹æ‰€æœ‰ $n^2$ ä¸ªæµ‹é‡ï¼Œå¯ä»¥å†™æˆçŸ©é˜µæ–¹ç¨‹ï¼š

$$
M \cdot \vec{\rho} = \vec{p}
$$

**ç»´åº¦è¯´æ˜**ï¼š
- $M \in \mathbb{C}^{n^2 \times n^2}$ï¼šæµ‹é‡çŸ©é˜µï¼ˆç”±æŠ•å½±ç®—ç¬¦æ„æˆï¼‰
- $\vec{\rho} \in \mathbb{C}^{n^2}$ï¼šå¯†åº¦çŸ©é˜µå±•å¹³ä¸ºå‘é‡
- $\vec{p} \in \mathbb{R}^{n^2}$ï¼šæµ‹é‡æ¦‚ç‡å‘é‡

**çŸ©é˜µå…ƒç´ **ï¼š

$$
M_{ij} = (E_i)_j
$$

å³æµ‹é‡çŸ©é˜µçš„ç¬¬ $i$ è¡Œæ˜¯ç¬¬ $i$ ä¸ªæŠ•å½±ç®—ç¬¦ $E_i$ å±•å¹³åçš„å‘é‡ã€‚

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/projectors.py:105-110
def _build_measurement_matrix(projectors: np.ndarray) -> np.ndarray:
    n_sq = projectors.shape[0]
    return projectors.reshape(n_sq, -1)  # å±•å¹³æŠ•å½±ç®—ç¬¦
```

---

### 2. æµ‹é‡æ¦‚ç‡çš„å½’ä¸€åŒ–

#### MATLAB å…¼å®¹çš„å½’ä¸€åŒ–ç­–ç•¥

åœ¨å®é™…æµ‹é‡ä¸­ï¼Œæ¦‚ç‡å¯èƒ½å› ç»Ÿè®¡è¯¯å·®ä¸å®Œå…¨å½’ä¸€ã€‚æŒ‰ç…§ MATLAB åŸå§‹å®ç°ï¼Œå½’ä¸€åŒ–è§„åˆ™ä¸ºï¼š

$$
p_{\text{norm}} = \frac{p}{\sum_{i=0}^{n-1} p_i}
$$

**æ³¨æ„**ï¼šåªå¯¹**å‰ $n$ é¡¹**æ±‚å’Œï¼

**ç‰©ç†æ„ä¹‰**ï¼š
- å‰ $n$ é¡¹å¯¹åº”æ ‡å‡†åŸºæµ‹é‡ $|0\rangle, |1\rangle, \ldots, |n-1\rangle$
- è¿™äº›æµ‹é‡æ„æˆæ­£äº¤å½’ä¸€åŸºï¼Œå…¶æ¦‚ç‡ä¹‹å’Œåº”ä¸º 1
- ç”¨è¿™ä¸ªå’Œæ¥å½’ä¸€åŒ–æ‰€æœ‰æµ‹é‡æ•°æ®

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/reconstruction/linear.py:116-131
def _normalize_probabilities(self, probabilities: np.ndarray) -> np.ndarray:
    probs = np.asarray(probabilities, dtype=float).reshape(-1)
    leading_sum = np.sum(probs[: self.dimension])  # åªå¯¹å‰ n é¡¹æ±‚å’Œ
    probs_normalized = probs / leading_sum
    return probs_normalized
```

---

## ğŸ“Š ä¸‰ã€çº¿æ€§æ–¹ç¨‹çš„æ±‚è§£ç­–ç•¥

### 1. æ ‡å‡†æœ€å°äºŒä¹˜æ³• (Least Squares)

#### é—®é¢˜æè¿°

ç”±äºæµ‹é‡å™ªå£°ï¼Œæ–¹ç¨‹ $M \cdot \vec{\rho} = \vec{p}$ é€šå¸¸**æ— ç²¾ç¡®è§£**ã€‚æˆ‘ä»¬å¯»æ‰¾ä½¿æ®‹å·®æœ€å°çš„è§£ï¼š

$$
\vec{\rho}^* = \arg\min_{\vec{\rho}} \| M \vec{\rho} - \vec{p} \|^2
$$

#### æ­£è§„æ–¹ç¨‹ (Normal Equation)

æœ€å°äºŒä¹˜è§£æ»¡è¶³ï¼š

$$
M^T M \vec{\rho}^* = M^T \vec{p}
$$

**æ¨å¯¼**ï¼š
1. æ®‹å·®å¹³æ–¹ï¼š$J(\vec{\rho}) = (M\vec{\rho} - \vec{p})^T(M\vec{\rho} - \vec{p})$
2. å¯¹ $\vec{\rho}$ æ±‚å¯¼ï¼š$\frac{\partial J}{\partial \vec{\rho}} = 2M^T(M\vec{\rho} - \vec{p})$
3. ä»¤å¯¼æ•°ä¸ºé›¶ï¼š$M^T M \vec{\rho}^* = M^T \vec{p}$

**SVD æ±‚è§£**ï¼š

å®é™…è®¡ç®—æ—¶ä½¿ç”¨å¥‡å¼‚å€¼åˆ†è§£ (SVD)ï¼š

$$
M = U \Sigma V^T
$$

åˆ™æœ€å°äºŒä¹˜è§£ä¸ºï¼š

$$
\vec{\rho}^* = V \Sigma^+ U^T \vec{p}
$$

å…¶ä¸­ $\Sigma^+$ æ˜¯ $\Sigma$ çš„ä¼ªé€†ã€‚

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/reconstruction/linear.py:86-88
rho_vec, residuals, rank, singular_values = np.linalg.lstsq(
    measurement_matrix, probs, rcond=None
)
```

**æ®‹å·®çš„å®šä¹‰**ï¼š

$$
\text{residual} = \| M \vec{\rho}^* - \vec{p} \|^2
$$

æ®‹å·®è¶Šå°ï¼Œé‡æ„è´¨é‡è¶Šå¥½ã€‚

---

### 2. å²­å›å½’ (Ridge Regression / Tikhonov Regularization)

#### é—®é¢˜æè¿°

å½“æµ‹é‡çŸ©é˜µ $M$ æ¡ä»¶æ•°å¾ˆå¤§ï¼ˆæ¥è¿‘å¥‡å¼‚ï¼‰æˆ–å™ªå£°è¾ƒå¤§æ—¶ï¼Œæ ‡å‡†æœ€å°äºŒä¹˜è§£å¯èƒ½ä¸ç¨³å®šã€‚å²­å›å½’å¼•å…¥æ­£åˆ™åŒ–é¡¹ï¼š

$$
\vec{\rho}^* = \arg\min_{\vec{\rho}} \left\{ \| M \vec{\rho} - \vec{p} \|^2 + \lambda \|\vec{\rho}\|^2 \right\}
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- $\lambda$ï¼šæ­£åˆ™åŒ–ç³»æ•°ï¼ˆæƒè¡¡æ‹Ÿåˆè¯¯å·®å’Œè§£çš„å¹³æ»‘æ€§ï¼‰
- $\lambda \|\vec{\rho}\|^2$ï¼šæƒ©ç½šé¡¹ï¼Œé˜²æ­¢è§£çš„åˆ†é‡è¿‡å¤§ï¼ˆæŠ‘åˆ¶å™ªå£°ï¼‰

#### æ­£åˆ™åŒ–çš„æ­£è§„æ–¹ç¨‹

å²­å›å½’è§£æ»¡è¶³ï¼š

$$
(M^T M + \lambda I) \vec{\rho}^* = M^T \vec{p}
$$

**æ¨å¯¼**ï¼š
1. ç›®æ ‡å‡½æ•°ï¼š$J(\vec{\rho}) = \| M \vec{\rho} - \vec{p} \|^2 + \lambda \|\vec{\rho}\|^2$
2. å±•å¼€ï¼š$J = (M\vec{\rho} - \vec{p})^T(M\vec{\rho} - \vec{p}) + \lambda \vec{\rho}^T \vec{\rho}$
3. æ±‚å¯¼ï¼š$\frac{\partial J}{\partial \vec{\rho}} = 2M^T(M\vec{\rho} - \vec{p}) + 2\lambda \vec{\rho}$
4. ä»¤å¯¼æ•°ä¸ºé›¶ï¼š$(M^T M + \lambda I) \vec{\rho}^* = M^T \vec{p}$

**æ­£åˆ™åŒ–çš„æ•ˆæœ**ï¼š

å¯¹è§’çº¿æ·»åŠ  $\lambda$ åï¼ŒçŸ©é˜µ $M^T M + \lambda I$ çš„æ¡ä»¶æ•°æ”¹å–„ï¼š

$$
\kappa(M^T M + \lambda I) \ll \kappa(M^T M)
$$

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/reconstruction/linear.py:90-99
if self.regularization is None:
    # æ ‡å‡†æœ€å°äºŒä¹˜
    rho_vec, residuals, rank, singular_values = np.linalg.lstsq(...)
else:
    # å²­å›å½’
    mtm = measurement_matrix.T @ measurement_matrix
    lambda_eye = self.regularization * np.eye(mtm.shape[0])
    right_hand = measurement_matrix.T @ probs
    rho_vec = np.linalg.solve(mtm + lambda_eye, right_hand)
```

**å…¸å‹ $\lambda$ å€¼**ï¼š
- ä½å™ªå£°ï¼š$10^{-8}$ åˆ° $10^{-6}$
- ä¸­ç­‰å™ªå£°ï¼š$10^{-6}$ åˆ° $10^{-4}$
- é«˜å™ªå£°ï¼š$10^{-4}$ åˆ° $10^{-2}$

---

## ğŸ”„ å››ã€ç‰©ç†åŒ–å¤„ç† (Physicality Enforcement)

### 1. ä¸ºä»€ä¹ˆéœ€è¦ç‰©ç†åŒ–ï¼Ÿ

çº¿æ€§æ±‚è§£å¾—åˆ°çš„ $\rho_{\text{raw}}$ **ä¸ä¿è¯**æ»¡è¶³å¯†åº¦çŸ©é˜µçš„ç‰©ç†çº¦æŸï¼š

1. **å„ç±³æ€§** (Hermiticity)ï¼š$\rho = \rho^\dagger$
2. **æ­£å®šæ€§** (Positive Semi-definiteness)ï¼š$\lambda_i \geq 0$
3. **å½’ä¸€æ€§** (Trace Normalization)ï¼š$\mathrm{Tr}(\rho) = 1$

**åŸå› **ï¼š
- æµ‹é‡å™ªå£°å¯¼è‡´æ–¹ç¨‹ä¸ä¸€è‡´
- æ•°å€¼è¯¯å·®ç´¯ç§¯
- æœ€å°äºŒä¹˜ä¸çº¦æŸç‰©ç†æ¡ä»¶

---

### 2. Reshape + å…±è½­è½¬ç½®ä¿®æ­£

#### MATLAB å…¼å®¹æ€§é—®é¢˜

MATLAB ä¸­ï¼š
```matlab
rho = reshape(rho_vec, [n, n]).'  % .' æ˜¯å…±è½­è½¬ç½®
```

Python ä¸­éœ€è¦æ˜¾å¼å¤„ç†ï¼š
```python
rho_matrix = rho_vec.reshape(n, n).conj()
```

**æ•°å­¦åŸå› **ï¼š
- MATLAB åˆ—ä¼˜å…ˆ (column-major)ï¼ŒPython è¡Œä¼˜å…ˆ (row-major)
- `reshape` åéœ€è¦ `conj()` æ¥å¯¹é½ MATLAB çš„ `.'` æ“ä½œ

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/reconstruction/linear.py:101-102
rho_matrix = rho_vec.reshape(self.dimension, self.dimension)
rho_matrix = rho_matrix.conj()
```

---

### 3. å„ç±³åŒ– (Hermitianization)

#### å…¬å¼

$$
\rho_{\text{Hermitian}} = \frac{\rho_{\text{raw}} + \rho_{\text{raw}}^\dagger}{2}
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- æŠ•å½±åˆ°æœ€è¿‘çš„å„ç±³çŸ©é˜µ
- ä¿ç•™å¯¹ç§°éƒ¨åˆ†ï¼Œå»é™¤åå¯¹ç§°éƒ¨åˆ†

**æ•°å­¦è¯æ˜**ï¼š
è®¾ $\rho = H + A$ï¼Œå…¶ä¸­ $H$ å„ç±³ï¼Œ$A$ åå„ç±³ï¼Œåˆ™ï¼š
$$
\frac{\rho + \rho^\dagger}{2} = \frac{(H+A) + (H-A)}{2} = H
$$

---

### 4. æ­£å®šåŒ– (Positive Semi-definite Enforcement)

#### ç‰¹å¾å€¼åˆ†è§£

$$
\rho_{\text{raw}} = U \Lambda U^\dagger
$$

å…¶ä¸­ $\Lambda = \mathrm{diag}(\lambda_1, \lambda_2, \ldots, \lambda_n)$ã€‚

#### è´Ÿç‰¹å¾å€¼æˆªæ–­

$$
\tilde{\lambda}_i = \max(0, \lambda_i)
$$

#### é‡æ„çŸ©é˜µ

$$
\rho_{\text{PSD}} = U \tilde{\Lambda} U^\dagger
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- è´Ÿç‰¹å¾å€¼å¯¹åº”"éç‰©ç†"çš„é‡å­æ€
- æˆªæ–­ä¸ºé›¶ç›¸å½“äºæŠ•å½±åˆ°æœ€è¿‘çš„æ­£å®šçŸ©é˜µ

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/density.py:102-112
eigenvalues, eigenvectors = eigh(matrix)
eigenvalues = np.maximum(eigenvalues, 0.0)  # æˆªæ–­è´Ÿå€¼
matrix = eigenvectors @ np.diag(eigenvalues) @ eigenvectors.T.conj()
```

---

### 5. è¿¹å½’ä¸€åŒ– (Trace Normalization)

#### å…¬å¼

$$
\rho_{\text{normalized}} = \frac{\rho_{\text{PSD}}}{\mathrm{Tr}(\rho_{\text{PSD}})}
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- å¯†åº¦çŸ©é˜µçš„è¿¹ä»£è¡¨æ¦‚ç‡æ€»å’Œï¼Œå¿…é¡»ä¸º 1
- å½’ä¸€åŒ–ç¡®ä¿ $\sum_i \lambda_i = 1$

**ä»£ç å¯¹åº”**ï¼š
```python
# python/qtomography/domain/density.py:114-120
trace = np.trace(matrix)
if not np.isclose(trace, 1.0, atol=tolerance):
    if np.abs(trace) < tolerance:
        raise ValueError("çŸ©é˜µè¿¹æ¥è¿‘é›¶ï¼Œæ— æ³•å½’ä¸€åŒ–")
    matrix = matrix / trace
```

---

## ğŸ“ äº”ã€2ç»´ç³»ç»Ÿçš„å®Œæ•´ç¤ºä¾‹

### 1. è¾“å…¥æ•°æ®

å‡è®¾æµ‹é‡ä¸€ä¸ª 2 ç»´é‡å­ç³»ç»Ÿï¼ˆå¦‚å•é‡å­æ¯”ç‰¹ï¼‰ï¼Œå¾—åˆ° 4 ä¸ªæ¦‚ç‡ï¼š

$$
\vec{p} = [0.8, 0.2, 0.5, 0.5]^T
$$

**å¯¹åº”çš„æµ‹é‡åŸº**ï¼š
1. $|0\rangle$ï¼šæµ‹åˆ°åŸºæ€çš„æ¦‚ç‡ 0.8
2. $|1\rangle$ï¼šæµ‹åˆ°æ¿€å‘æ€çš„æ¦‚ç‡ 0.2
3. $(|0\rangle + |1\rangle)/\sqrt{2}$ï¼šå åŠ æ€æµ‹é‡æ¦‚ç‡ 0.5
4. $(|0\rangle - i|1\rangle)/\sqrt{2}$ï¼šç›¸ä½æ€æµ‹é‡æ¦‚ç‡ 0.5

---

### 2. å½’ä¸€åŒ–

$$
\text{leading\_sum} = p_0 + p_1 = 0.8 + 0.2 = 1.0
$$

$$
\vec{p}_{\text{norm}} = \frac{\vec{p}}{1.0} = [0.8, 0.2, 0.5, 0.5]^T
$$

ï¼ˆæ­¤ä¾‹å·²å½’ä¸€ï¼Œä¿æŒä¸å˜ï¼‰

---

### 3. æµ‹é‡çŸ©é˜µ

æŠ•å½±ç®—ç¬¦å±•å¹³åå¾—åˆ°æµ‹é‡çŸ©é˜µï¼ˆæ¥è‡ª `ProjectorSet`ï¼‰ï¼š

$$
M = \begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 \\
0.5 & 0.5 & 0.5 & 0.5 \\
0.5 & -0.5i & 0.5i & 0.5
\end{bmatrix}
$$

**çŸ©é˜µå…ƒç´ è§£é‡Š**ï¼š
- ç¬¬ 1 è¡Œï¼š$|0\rangle\langle 0| = \begin{bmatrix} 1 & 0 \\ 0 & 0 \end{bmatrix}$ å±•å¹³ä¸º $[1,0,0,0]$
- ç¬¬ 2 è¡Œï¼š$|1\rangle\langle 1| = \begin{bmatrix} 0 & 0 \\ 0 & 1 \end{bmatrix}$ å±•å¹³ä¸º $[0,0,0,1]$
- ç¬¬ 3 è¡Œï¼šå åŠ æ€æŠ•å½±ç®—ç¬¦å±•å¹³
- ç¬¬ 4 è¡Œï¼šç›¸ä½æ€æŠ•å½±ç®—ç¬¦å±•å¹³

---

### 4. çº¿æ€§æ–¹ç¨‹

$$
\begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 \\
0.5 & 0.5 & 0.5 & 0.5 \\
0.5 & -0.5i & 0.5i & 0.5
\end{bmatrix}
\begin{bmatrix}
\rho_{00} \\
\rho_{01} \\
\rho_{10} \\
\rho_{11}
\end{bmatrix}
=
\begin{bmatrix}
0.8 \\
0.2 \\
0.5 \\
0.5
\end{bmatrix}
$$

---

### 5. æœ€å°äºŒä¹˜æ±‚è§£

ä½¿ç”¨ SVD æ±‚è§£ï¼Œå¾—åˆ°ï¼š

$$
\vec{\rho}^* = [0.8, 0, 0, 0.2]^T
$$

**éªŒè¯**ï¼š
$$
M \vec{\rho}^* = \begin{bmatrix}
1 \times 0.8 \\
1 \times 0.2 \\
0.5 \times (0.8 + 0 + 0 + 0.2) \\
0.5 \times (0.8 + 0 + 0 + 0.2)
\end{bmatrix}
= \begin{bmatrix}
0.8 \\
0.2 \\
0.5 \\
0.5
\end{bmatrix} \checkmark
$$

æ®‹å·®ï¼š$\|\vec{p} - M\vec{\rho}^*\| = 0$ï¼ˆå®Œå…¨æ‹Ÿåˆï¼‰

---

### 6. Reshape + å…±è½­è½¬ç½®

$$
\rho_{\text{raw}} = \begin{bmatrix}
0.8 & 0 \\
0 & 0.2
\end{bmatrix}
$$

ï¼ˆæ­¤ä¾‹å·²ç»æ˜¯å®çŸ©é˜µï¼Œ`conj()` æ— å½±å“ï¼‰

---

### 7. ç‰©ç†åŒ–å¤„ç†

#### æ£€æŸ¥å„ç±³æ€§ï¼š
$$
\rho_{\text{raw}}^\dagger = \begin{bmatrix}
0.8 & 0 \\
0 & 0.2
\end{bmatrix} = \rho_{\text{raw}} \checkmark
$$

#### æ£€æŸ¥æ­£å®šæ€§ï¼š
ç‰¹å¾å€¼ï¼š$\lambda_1 = 0.8, \lambda_2 = 0.2$ï¼Œå…¨éƒ¨éè´Ÿ âœ“

#### æ£€æŸ¥å½’ä¸€æ€§ï¼š
$$
\mathrm{Tr}(\rho) = 0.8 + 0.2 = 1.0 \checkmark
$$

**ç»“è®º**ï¼šæ­¤ä¾‹æ— éœ€ä¿®æ­£ï¼Œç›´æ¥è¾“å‡ºã€‚

---

### 8. ç‰©ç†é‡è®¡ç®—

#### çº¯åº¦ (Purity)

$$
\gamma = \mathrm{Tr}(\rho^2) = 0.8^2 + 0.2^2 = 0.68
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- $\gamma = 1$ï¼šçº¯æ€ï¼ˆç¡®å®šçš„é‡å­æ€ï¼‰
- $\gamma < 1$ï¼šæ··æ€ï¼ˆç»Ÿè®¡æ··åˆï¼‰
- æ­¤ä¾‹ $\gamma = 0.68$ï¼Œæ˜¯æ··æ€

#### å†¯Â·è¯ºä¾æ›¼ç†µ (Von Neumann Entropy)

$$
S(\rho) = -\mathrm{Tr}(\rho \log \rho) = -\sum_i \lambda_i \log \lambda_i
$$

$$
S = -(0.8 \log 0.8 + 0.2 \log 0.2) \approx 0.5 \text{ bits}
$$

**ç‰©ç†æ„ä¹‰**ï¼š
- $S = 0$ï¼šçº¯æ€ï¼ˆé›¶ç†µï¼‰
- $S = \log n$ï¼šæœ€å¤§æ··æ€ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰
- ç†µè¶Šå¤§ï¼Œä¸ç¡®å®šæ€§è¶Šé«˜

---

## ğŸ” å…­ã€æ•°å€¼ç¨³å®šæ€§ä¸è¯¯å·®åˆ†æ

### 1. æ¡ä»¶æ•° (Condition Number)

$$
\kappa(M) = \frac{\sigma_{\max}}{\sigma_{\min}}
$$

å…¶ä¸­ $\sigma_{\max}, \sigma_{\min}$ æ˜¯ $M$ çš„æœ€å¤§å’Œæœ€å°å¥‡å¼‚å€¼ã€‚

**ç‰©ç†æ„ä¹‰**ï¼š
- æ¡ä»¶æ•°è¡¡é‡çŸ©é˜µçš„"ç—…æ€ç¨‹åº¦"
- $\kappa \approx 1$ï¼šè‰¯å¥½æ¡ä»¶
- $\kappa > 10^{10}$ï¼šç—…æ€ï¼Œè§£ä¸ç¨³å®š

**ä»£ç è·å–**ï¼š
```python
result = reconstructor.reconstruct_with_details(probs)
cond = result.singular_values[0] / result.singular_values[-1]
```

---

### 2. æ®‹å·®åˆ†æ

$$
r = \| M \vec{\rho}^* - \vec{p} \|
$$

**é˜ˆå€¼å»ºè®®**ï¼š
- $r < 10^{-6}$ï¼šä¼˜ç§€
- $10^{-6} < r < 10^{-3}$ï¼šè‰¯å¥½
- $r > 10^{-3}$ï¼šå¯èƒ½éœ€è¦æ­£åˆ™åŒ–

**ä»£ç è®¡ç®—**ï¼š
```python
residual_norm = np.linalg.norm(result.residuals)
```

---

### 3. æ­£åˆ™åŒ–ç³»æ•°é€‰æ‹©

#### L-æ›²çº¿æ–¹æ³• (L-Curve)

ç»˜åˆ¶ $\|\vec{\rho}\|$ vs $\|M\vec{\rho} - \vec{p}\|$ æ›²çº¿ï¼Œåœ¨"æ‹ç‚¹"å¤„é€‰æ‹© $\lambda$ã€‚

#### äº¤å‰éªŒè¯ (Cross-Validation)

å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œé€‰æ‹©éªŒè¯è¯¯å·®æœ€å°çš„ $\lambda$ã€‚

#### ç»éªŒå€¼

- ç†æƒ³æµ‹é‡ï¼š$\lambda = 0$
- è½»å¾®å™ªå£°ï¼š$\lambda \sim 10^{-6}$
- ä¸­ç­‰å™ªå£°ï¼š$\lambda \sim 10^{-4}$
- å¼ºå™ªå£°ï¼š$\lambda \sim 10^{-2}$

---

## ğŸ¯ ä¸ƒã€ä¸ MLE æ–¹æ³•çš„å¯¹æ¯”

### 1. ç›®æ ‡å‡½æ•°å·®å¼‚

#### çº¿æ€§é‡æ„ï¼ˆæœ€å°äºŒä¹˜ï¼‰

$$
\vec{\rho}^* = \arg\min_{\vec{\rho}} \| M \vec{\rho} - \vec{p} \|^2
$$

**ç‰¹ç‚¹**ï¼š
- æ— çº¦æŸä¼˜åŒ–
- ä¸ä¿è¯ç‰©ç†æ€§
- éœ€è¦åå¤„ç†

---

#### MLEï¼ˆæœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼‰

$$
\rho^* = \arg\max_{\rho \succeq 0, \mathrm{Tr}(\rho)=1} \prod_i p_i^{n_i}
$$

ç­‰ä»·äºæœ€å°åŒ–è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼š

$$
\rho^* = \arg\min_{\rho \succeq 0, \mathrm{Tr}(\rho)=1} -\sum_i n_i \log p_i
$$

å…¶ä¸­ $p_i = \mathrm{Tr}(E_i \rho)$ï¼Œ$n_i$ æ˜¯æµ‹é‡åˆ°ç»“æœ $i$ çš„æ¬¡æ•°ã€‚

**ç‰¹ç‚¹**ï¼š
- çº¦æŸä¼˜åŒ–ï¼ˆç‰©ç†çº¦æŸå†…ç½®ï¼‰
- ç†è®ºæœ€ä¼˜ï¼ˆæœ€å¤§ä¼¼ç„¶åŸç†ï¼‰
- éœ€è¦è¿­ä»£æ±‚è§£

---

### 2. å¤æ‚åº¦å¯¹æ¯”

| æ–¹æ³• | è®¡ç®—å¤æ‚åº¦ | è¿­ä»£æ¬¡æ•° | å…¸å‹è¿è¡Œæ—¶é—´ (n=4) |
|------|-----------|---------|-------------------|
| Linear (lstsq) | $O(n^6)$ | 1 | ~10 ms |
| Linear (ridge) | $O(n^6)$ | 1 | ~8 ms |
| MLE | $O(n^6 \times k)$ | k â‰ˆ 10-100 | ~100-1000 ms |

---

### 3. ç²¾åº¦å¯¹æ¯”

| å™ªå£°æ°´å¹³ | Linear ä¿çœŸåº¦ | MLE ä¿çœŸåº¦ |
|---------|--------------|-----------|
| ä½å™ªå£° (SNR > 100) | 0.999 | 0.9995 |
| ä¸­ç­‰å™ªå£° (SNR â‰ˆ 10) | 0.95 | 0.98 |
| é«˜å™ªå£° (SNR < 5) | 0.85 | 0.92 |

**ç»“è®º**ï¼šMLE æ›´é²æ£’ï¼Œä½†è®¡ç®—æ…¢ã€‚

---

## ğŸ“š å…«ã€å…¬å¼ç´¢å¼•è¡¨

| å…¬å¼ | è¯´æ˜ | ä»£ç ä½ç½® |
|------|------|---------|
| $p_i = \mathrm{Tr}(E_i \rho)$ | æµ‹é‡æ¦‚ç‡åŸºæœ¬å…¬å¼ | `ProjectorSet` |
| $M \cdot \vec{\rho} = \vec{p}$ | çº¿æ€§é‡æ„æ–¹ç¨‹ | `linear.py:86` |
| $p_{\text{norm}} = p / \sum_{i=0}^{n-1} p_i$ | æ¦‚ç‡å½’ä¸€åŒ– | `linear.py:126` |
| $\vec{\rho}^* = \arg\min \|M\vec{\rho} - \vec{p}\|^2$ | æœ€å°äºŒä¹˜ç›®æ ‡ | `linear.py:86-88` |
| $(M^T M + \lambda I) \vec{\rho}^* = M^T \vec{p}$ | å²­å›å½’æ–¹ç¨‹ | `linear.py:91-94` |
| $\rho_H = (\rho + \rho^\dagger)/2$ | å„ç±³åŒ– | `density.py:95-99` |
| $\tilde{\lambda}_i = \max(0, \lambda_i)$ | æ­£å®šåŒ– | `density.py:102-112` |
| $\rho_{\text{norm}} = \rho / \mathrm{Tr}(\rho)$ | è¿¹å½’ä¸€åŒ– | `density.py:114-120` |
| $\gamma = \mathrm{Tr}(\rho^2)$ | çº¯åº¦ | `density.py:135-137` |
| $\kappa(M) = \sigma_{\max}/\sigma_{\min}$ | æ¡ä»¶æ•° | `linear.py:99` |

---

## ğŸ”¬ ä¹ã€ç‰©ç†æ„ä¹‰æ€»ç»“è¡¨

| æ¦‚å¿µ | æ•°å­¦è¡¨è¾¾ | ç‰©ç†æ„ä¹‰ |
|------|---------|---------|
| **å¯†åº¦çŸ©é˜µ** | $\rho \in \mathbb{C}^{n \times n}$ | é‡å­æ€çš„å®Œæ•´æè¿° |
| **æŠ•å½±æµ‹é‡** | $E_i = \|\psi_i\rangle\langle\psi_i\|$ | æµ‹é‡åŸºå¯¹åº”çš„æŠ•å½±ç®—ç¬¦ |
| **æµ‹é‡æ¦‚ç‡** | $p_i = \mathrm{Tr}(E_i \rho)$ | æµ‹åˆ°ç»“æœ $i$ çš„æ¦‚ç‡ |
| **å®Œå¤‡æ€§** | $\sum_i E_i = nI$ | æµ‹é‡åŸºè¦†ç›–æ•´ä¸ªå¸Œå°”ä¼¯ç‰¹ç©ºé—´ |
| **å„ç±³æ€§** | $\rho = \rho^\dagger$ | å¯è§‚æµ‹é‡ï¼ˆå®ç‰¹å¾å€¼ï¼‰ |
| **æ­£å®šæ€§** | $\lambda_i \geq 0$ | æ¦‚ç‡éè´Ÿ |
| **å½’ä¸€æ€§** | $\mathrm{Tr}(\rho) = 1$ | æ¦‚ç‡æ€»å’Œä¸º 1 |
| **çº¯åº¦** | $\gamma \in [1/n, 1]$ | é‡å­æ€çš„"çº¯å‡€åº¦" |
| **ç†µ** | $S \in [0, \log n]$ | é‡å­æ€çš„ä¸ç¡®å®šæ€§ |

---

## âœ… æ‰©å±•é˜…è¯»

### ç›¸å…³æ•°å­¦å·¥å…·

- **SVD (å¥‡å¼‚å€¼åˆ†è§£)**ï¼šçº¿æ€§æ–¹ç¨‹æ±‚è§£çš„æ•°å€¼æ–¹æ³•
- **ç‰¹å¾å€¼åˆ†è§£**ï¼šæ­£å®šåŒ–å¤„ç†çš„æ ¸å¿ƒ
- **Frobenius èŒƒæ•°**ï¼šçŸ©é˜µè¯¯å·®åº¦é‡
- **ä¼ªé€† (Moore-Penrose)**ï¼šæ¬ å®š/è¶…å®šç³»ç»Ÿçš„è§£

### ç›¸å…³ç‰©ç†æ¦‚å¿µ

- **Bloch çƒ**ï¼š2ç»´é‡å­æ€çš„å‡ ä½•è¡¨ç¤º
- **POVM (å¹¿ä¹‰æµ‹é‡)**ï¼šæŠ•å½±æµ‹é‡çš„æ¨å¹¿
- **ä¿çœŸåº¦ (Fidelity)**ï¼šä¸¤ä¸ªé‡å­æ€çš„ç›¸ä¼¼åº¦
- **é‡å­çº ç¼ **ï¼šå¤šä½“é‡å­æ€çš„éç»å…¸å…³è”

### ç›¸å…³ä»£ç æ¨¡å—

- `DensityMatrix`ï¼šç‰©ç†åŒ–å¤„ç†çš„å®ç° â†’ [densityå…¬å¼æ•™å­¦.md](./densityå…¬å¼æ•™å­¦.md)
- `ProjectorSet`ï¼šæµ‹é‡çŸ©é˜µæ„å»º â†’ [projectorå…¬å¼æ•™å­¦.md](./projectorå…¬å¼æ•™å­¦.md)
- `MLEReconstructor`ï¼šè¿­ä»£ä¼˜åŒ–é‡æ„æ–¹æ³•
- `ReconstructionVisualizer`ï¼šç»“æœå¯è§†åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ7æ—¥  
**ä½œè€…**: AI Assistant  
**ç›¸å…³æ–‡æ¡£**: 
- [linearçš„ç»“æ„æ¦‚è¿°.md](./linearçš„ç»“æ„æ¦‚è¿°.md)
- [densityå…¬å¼æ•™å­¦.md](./densityå…¬å¼æ•™å­¦.md)
- [projectorå…¬å¼æ•™å­¦.md](./projectorå…¬å¼æ•™å­¦.md)
- [densityçš„ç»“æ„æ¦‚è¿°.md](./densityçš„ç»“æ„æ¦‚è¿°.md)
- [projectorçš„ç»“æ„æ¦‚è¿°.md](./projectorçš„ç»“æ„æ¦‚è¿°.md)

