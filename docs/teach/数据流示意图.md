# é‡å­æ€å±‚æé‡æ„é¡¹ç›®æ•°æ®æµç¤ºæ„å›¾

> **ç›®æ ‡**ï¼šæ¸…æ™°å±•ç¤ºæ•°æ®åœ¨é¡¹ç›®ä¸­çš„æµè½¬è¿‡ç¨‹

---

## ğŸ”„ **æ ¸å¿ƒæ•°æ®æµ**

```
ç”¨æˆ·è¾“å…¥ â†’ CLIè§£æ â†’ åº”ç”¨å±‚æ§åˆ¶ â†’ é¢†åŸŸå±‚è®¡ç®— â†’ åŸºç¡€è®¾æ–½å±‚æŒä¹…åŒ– â†’ ç»“æœè¾“å‡º
```

---

## ğŸ“Š **è¯¦ç»†æ•°æ®è½¬æ¢è¿‡ç¨‹**

### **é˜¶æ®µ1ï¼šè¾“å…¥æ•°æ®å‡†å¤‡**

```mermaid
graph LR
    A[CSVæ–‡ä»¶] --> B[pandas.DataFrame]
    B --> C[æ¦‚ç‡å‘é‡æ•°ç»„]
    
    A1["data.csv<br/>0.5,0.5,0.25,0.25<br/>0.6,0.4,0.3,0.2"] --> B1["DataFrame<br/>shape: (4, 2)<br/>4ä¸ªæ¦‚ç‡å€¼ï¼Œ2ä¸ªæ ·æœ¬"]
    B1 --> C1["æ¦‚ç‡å‘é‡<br/>probs = [0.5,0.5,0.25,0.25]<br/>å•ä¸ªæ ·æœ¬çš„æ¦‚ç‡"]
```

### **é˜¶æ®µ2ï¼šé‡æ„å™¨è®¡ç®—**

```mermaid
graph TB
    D[æ¦‚ç‡å‘é‡] --> E[çº¿æ€§é‡æ„]
    D --> F[MLEé‡æ„]
    
    E --> E1[æµ‹é‡çŸ©é˜µ]
    E1 --> E2[æœ€å°äºŒä¹˜æ±‚è§£]
    E2 --> E3[å¯†åº¦çŸ©é˜µ]
    
    F --> F1[åˆå§‹å¯†åº¦çŸ©é˜µ]
    F1 --> F2[ä¼˜åŒ–æ±‚è§£]
    F2 --> F3[å¯†åº¦çŸ©é˜µ]
    
    E3 --> G[ç‰©ç†åŒ–å¤„ç†]
    F3 --> G
    G --> H[æœ€ç»ˆå¯†åº¦çŸ©é˜µ]
```

### **é˜¶æ®µ3ï¼šç»“æœè¾“å‡º**

```mermaid
graph LR
    I[å¯†åº¦çŸ©é˜µ] --> J[JSONè®°å½•]
    I --> K[CSVæ±‡æ€»]
    I --> L[å¯è§†åŒ–å›¾è¡¨]
    
    J --> J1["record_2_xxx.json<br/>{<br/>  'density_matrix': [[0.5,0.5],[0.5,0.5]],<br/>  'metrics': {...}<br/>}"]
    
    K --> K1["summary.csv<br/>sample,method,purity,trace<br/>0,linear,0.75,1.0<br/>0,mle,0.75,1.0"]
    
    L --> L1["density_heatmap.png<br/>3Då¯è§†åŒ–å›¾è¡¨"]
```

---

## ğŸ¯ **å…³é”®æ•°æ®è½¬æ¢ç‚¹**

### **1. æ¦‚ç‡å‘é‡ â†’ å¯†åº¦çŸ©é˜µ**

```python
# è¾“å…¥ï¼šæ¦‚ç‡å‘é‡
probs = np.array([0.5, 0.5, 0.25, 0.25])

# çº¿æ€§é‡æ„è¿‡ç¨‹
measurement_matrix = projector_set.measurement_matrix  # (4, 4)
rho_vec = np.linalg.lstsq(measurement_matrix, probs)[0]  # (4,)
rho_matrix = vec_to_density_matrix(rho_vec)  # (2, 2)

# è¾“å‡ºï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])
```

### **2. å¯†åº¦çŸ©é˜µ â†’ ç‰©ç†é‡**

```python
# è¾“å…¥ï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])

# è®¡ç®—ç‰©ç†é‡
purity = np.trace(density_matrix @ density_matrix)  # 0.75
trace = np.trace(density_matrix)  # 1.0
eigenvalues = np.linalg.eigvals(density_matrix)  # [0.146, 0.854]

# è¾“å‡ºï¼šç‰©ç†é‡å­—å…¸
metrics = {
    "purity": 0.75,
    "trace": 1.0,
    "min_eigenvalue": 0.146,
    "max_eigenvalue": 0.854
}
```

### **3. ç»“æœå¯¹è±¡ â†’ æ–‡ä»¶**

```python
# è¾“å…¥ï¼šé‡æ„ç»“æœ
result = LinearReconstructionResult(
    density=density_matrix,
    residuals=residuals,
    rank=4,
    singular_values=singular_values
)

# åˆ›å»ºè®°å½•
record = ReconstructionRecord(
    method="linear",
    dimension=2,
    probabilities=probs,
    density_matrix=density_matrix,
    metrics=metrics,
    metadata={"sample_index": 0}
)

# è¾“å‡ºï¼šJSONæ–‡ä»¶
{
    "method": "linear",
    "dimension": 2,
    "probabilities": [0.5, 0.5, 0.25, 0.25],
    "density_matrix": [[0.5, 0.5], [0.5, 0.5]],
    "metrics": {
        "purity": 0.75,
        "trace": 1.0,
        "rank": 4.0,
        "min_eigenvalue": 0.146,
        "max_eigenvalue": 0.854
    }
}
```

---

## ğŸš€ **å®Œæ•´è¿è¡Œæµç¨‹**

### **æ­¥éª¤1ï¼šç”¨æˆ·è¾“å…¥**
```bash
qtomography reconstruct data.csv --method both --dimension 4
```

### **æ­¥éª¤2ï¼šæ•°æ®åŠ è½½**
```python
# åŠ è½½CSVæ–‡ä»¶
data = pd.read_csv("data.csv")  # shape: (4, 3)
# 4ä¸ªæ¦‚ç‡å€¼ï¼Œ3ä¸ªæ ·æœ¬
```

### **æ­¥éª¤3ï¼šæ‰¹å¤„ç†å¾ªç¯**
```python
for idx in range(3):  # 3ä¸ªæ ·æœ¬
    probs = data[:, idx]  # æå–æ¦‚ç‡å‘é‡
    
    # çº¿æ€§é‡æ„
    linear_result = linear.reconstruct_with_details(probs)
    
    # MLEé‡æ„
    mle_result = mle.reconstruct_with_details(probs)
    
    # ä¿å­˜ç»“æœ
    save_record(linear_result)
    save_record(mle_result)
```

### **æ­¥éª¤4ï¼šç»“æœæ±‡æ€»**
```python
# ç”ŸæˆCSVæ±‡æ€»
summary_df = pd.DataFrame(summary_rows)
summary_df.to_csv("summary.csv")
```

---

## ğŸ“ **è¾“å‡ºæ–‡ä»¶ç»“æ„**

```
demo_output/
â”œâ”€â”€ records/                          # è¯¦ç»†è®°å½•
â”‚   â”œâ”€â”€ record_2_2025-10-07T14-16-37.json  # æ ·æœ¬0çº¿æ€§é‡æ„
â”‚   â”œâ”€â”€ record_2_2025-10-07T14-16-38.json  # æ ·æœ¬0 MLEé‡æ„
â”‚   â”œâ”€â”€ record_2_2025-10-07T14-16-39.json  # æ ·æœ¬1çº¿æ€§é‡æ„
â”‚   â””â”€â”€ record_2_2025-10-07T14-16-40.json  # æ ·æœ¬1 MLEé‡æ„
â”œâ”€â”€ summary.csv                       # æ±‡æ€»æŠ¥å‘Š
â””â”€â”€ plots/                           # å¯è§†åŒ–å›¾è¡¨
    â”œâ”€â”€ density_heatmap_0.png
    â”œâ”€â”€ amplitude_phase_0.png
    â””â”€â”€ ...
```

---

## ğŸ’¡ **æ•°æ®æµå…³é”®ç‚¹**

### **1. æ•°æ®ç»´åº¦å˜åŒ–**
```
CSV: (4, 3) â†’ æ¦‚ç‡å‘é‡: (4,) â†’ å¯†åº¦çŸ©é˜µ: (2, 2)
```

### **2. æ•°æ®ç±»å‹è½¬æ¢**
```
å­—ç¬¦ä¸² â†’ æµ®ç‚¹æ•° â†’ å¤æ•°çŸ©é˜µ â†’ JSONå­—ç¬¦ä¸²
```

### **3. æ•°æ®æµå‘**
```
æ–‡ä»¶ â†’ å†…å­˜ â†’ è®¡ç®— â†’ å†…å­˜ â†’ æ–‡ä»¶
```

### **4. æ•°æ®éªŒè¯**
```
è¾“å…¥éªŒè¯ â†’ è®¡ç®—éªŒè¯ â†’ ç‰©ç†çº¦æŸéªŒè¯ â†’ è¾“å‡ºéªŒè¯
```

---

## ğŸ¯ **æ€»ç»“**

**æ•°æ®æµæ ¸å¿ƒ**ï¼š
1. **è¾“å…¥**ï¼šCSVæ¦‚ç‡æ•°æ®
2. **å¤„ç†**ï¼šé‡æ„ç®—æ³•è®¡ç®—
3. **è¾“å‡º**ï¼šJSONè®°å½• + CSVæ±‡æ€»

**å…³é”®è½¬æ¢**ï¼š
- æ¦‚ç‡å‘é‡ â†’ å¯†åº¦çŸ©é˜µ
- å¯†åº¦çŸ©é˜µ â†’ ç‰©ç†é‡
- ç»“æœå¯¹è±¡ â†’ æ–‡ä»¶æ ¼å¼

**æµç¨‹æ§åˆ¶**ï¼š
- CLIå±‚ï¼šå‚æ•°è§£æ
- åº”ç”¨å±‚ï¼šæ‰¹å¤„ç†æ§åˆ¶
- é¢†åŸŸå±‚ï¼šç®—æ³•è®¡ç®—
- åŸºç¡€è®¾æ–½å±‚ï¼šç»“æœæŒä¹…åŒ–

è®°ä½ï¼š**æ•°æ®åœ¨æ¯ä¸€å±‚éƒ½ä¼šå‘ç”Ÿè½¬æ¢ï¼Œä½†æ ¸å¿ƒçš„è®¡ç®—é€»è¾‘åœ¨é¢†åŸŸå±‚çš„é‡æ„å™¨ä¸­ï¼**
