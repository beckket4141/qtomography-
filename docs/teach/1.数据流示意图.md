# é‡å­æ€å±‚æé‡æ„é¡¹ç›®æ•°æ®æµç¤ºæ„å›¾

> **ç›®æ ‡**ï¼šæ¸…æ™°å±•ç¤ºæ•°æ®åœ¨é¡¹ç›®ä¸­çš„æµè½¬è¿‡ç¨‹  
> **æ›´æ–°æ—¥æœŸ**: 2025å¹´11æœˆ  
> **é¡¹ç›®ç‰ˆæœ¬**: v1.0.0

---

## ğŸ”„ **æ ¸å¿ƒæ•°æ®æµ**

```
ç”¨æˆ·è¾“å…¥ â†’ CLIè§£æ â†’ åº”ç”¨å±‚æ§åˆ¶ â†’ é¢†åŸŸå±‚è®¡ç®— â†’ åŸºç¡€è®¾æ–½å±‚æŒä¹…åŒ– â†’ ç»“æœè¾“å‡º
```

---

## ğŸ“Š **è¯¦ç»†æ•°æ®è½¬æ¢è¿‡ç¨‹**

### **é˜¶æ®µ1ï¼šè¾“å…¥æ•°æ®å‡†å¤‡**

```mermaid
graph LR
    A[CSVæ–‡ä»¶] --> B[pandas.DataFrame]
    B --> C[æ¦‚ç‡å‘é‡æ•°ç»„]
    
    A1["data.csv<br/>0.5,0.5,0.25,0.25<br/>0.6,0.4,0.3,0.2"] --> B1["DataFrame<br/>shape: (4, 2)<br/>4ä¸ªæ¦‚ç‡å€¼ï¼Œ2ä¸ªæ ·æœ¬"]
    B1 --> C1["æ¦‚ç‡å‘é‡<br/>probs = [0.5,0.5,0.25,0.25]<br/>å•ä¸ªæ ·æœ¬çš„æ¦‚ç‡"]
```

### **é˜¶æ®µ2ï¼šé‡æ„å™¨è®¡ç®—**

```mermaid
graph TB
    D[æ¦‚ç‡å‘é‡] --> E[çº¿æ€§é‡æ„]
    D --> F[WLSé‡æ„]
    D --> G[RÏR Stricté‡æ„]
    D --> H[MLEé‡æ„]
    
    E --> E1[æµ‹é‡çŸ©é˜µ]
    E1 --> E2[æœ€å°äºŒä¹˜/å²­å›å½’]
    E2 --> E3[å¯†åº¦çŸ©é˜µ]
    
    F --> F1[åˆå§‹å¯†åº¦çŸ©é˜µ]
    F1 --> F2[ä¼˜åŒ–æ±‚è§£]
    F2 --> F3[å¯†åº¦çŸ©é˜µ]
    
    G --> G1[æ”¯æ’‘ç®—ç¬¦]
    G1 --> G2[RÏRè¿­ä»£]
    G2 --> G3[å¯†åº¦çŸ©é˜µ]
    
    H --> H1[åˆå§‹å¯†åº¦çŸ©é˜µ]
    H1 --> H2[ä¼˜åŒ–æ±‚è§£]
    H2 --> H3[å¯†åº¦çŸ©é˜µ]
    
    E3 --> I[ç‰©ç†åŒ–å¤„ç†]
    F3 --> I
    G3 --> I
    H3 --> I
    I --> J[æœ€ç»ˆå¯†åº¦çŸ©é˜µ]
```

### **é˜¶æ®µ3ï¼šç»“æœè¾“å‡º**

```mermaid
graph LR
    I[å¯†åº¦çŸ©é˜µ] --> J[JSONè®°å½•]
    I --> K[CSVæ±‡æ€»]
    I --> L[å¯è§†åŒ–å›¾è¡¨]
    I --> M[è°±åˆ†è§£åˆ†æ]
    
    J --> J1["record_2_xxx.json<br/>{<br/>  'density_matrix': [[0.5,0.5],[0.5,0.5]],<br/>  'metrics': {...},<br/>  'method': 'linear'<br/>}"]
    
    K --> K1["summary.csv<br/>sample,method,purity,trace,design<br/>0,linear,0.75,1.0,mub<br/>0,wls,0.75,1.0,mub<br/>0,rhor_strict,0.75,1.0,nopovm<br/>0,mle,0.75,1.0,mub"]
    
    L --> L1["density_heatmap.png<br/>3Då¯è§†åŒ–å›¾è¡¨"]
    
    M --> M1["spectral_report.csv<br/>eigenvalue,eigenvector,purity<br/>0.854,[...],0.75"]
    M --> M2["spectral_plot.png<br/>ç‰¹å¾å€¼åˆ†å¸ƒå›¾"]
```

---

## ğŸ¯ **å…³é”®æ•°æ®è½¬æ¢ç‚¹**

### **1. æ¦‚ç‡å‘é‡ â†’ å¯†åº¦çŸ©é˜µ**

#### **çº¿æ€§é‡æ„**
```python
# è¾“å…¥ï¼šæ¦‚ç‡å‘é‡
probs = np.array([0.5, 0.5, 0.25, 0.25])

# çº¿æ€§é‡æ„è¿‡ç¨‹
measurement_matrix = projector_set.measurement_matrix  # (4, 4)
if regularization is None:
    rho_vec = np.linalg.lstsq(measurement_matrix, probs)[0]  # (4,)
else:
    # å²­å›å½’
    rho_vec = np.linalg.solve(M.T @ M + Î»*I, M.T @ probs)
rho_matrix = vec_to_density_matrix(rho_vec)  # (2, 2)

# è¾“å‡ºï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])
```

#### **WLSé‡æ„**
```python
# è¾“å…¥ï¼šæ¦‚ç‡å‘é‡
probs = np.array([0.5, 0.5, 0.25, 0.25])

# WLSé‡æ„è¿‡ç¨‹
initial_density = prepare_initial_density(probs)  # åˆå§‹å¯†åº¦çŸ©é˜µ
params0 = encode_density_to_params(initial_density)  # å‚æ•°åŒ–

# ä¼˜åŒ–æ±‚è§£
result = minimize(
    objective_function,  # ChiÂ²ç›®æ ‡å‡½æ•°
    params0,
    method='L-BFGS-B'
)

rho_matrix = decode_params_to_density(result.x)  # (2, 2)

# è¾“å‡ºï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])
```

#### **RÏR Stricté‡æ„**
```python
# è¾“å…¥ï¼šè®¡æ•°æˆ–æ¦‚ç‡å‘é‡
counts_or_probs = np.array([0.5, 0.5, 0.25, 0.25])

# RÏR Stricté‡æ„è¿‡ç¨‹
f = normalize_per_group(counts_or_probs)  # æŒ‰ç»„å½’ä¸€åŒ–
H = np.sum(projectors, axis=0)  # Hç®—ç¬¦
E_tilde = build_normalized_povm(projectors, H)  # å½’ä¸€åŒ–POVM

# RÏRè¿­ä»£ï¼ˆåœ¨Ïƒç©ºé—´ï¼‰
sigma = iterate_rrr_sigma(E_tilde, f, sigma0)

# æ˜ å°„å›Ïç©ºé—´
rho_matrix = H_sqrt_inv @ sigma @ H_sqrt_inv / Tr(H_inv @ sigma)

# è¾“å‡ºï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])
```

#### **MLEé‡æ„**
```python
# è¾“å…¥ï¼šæ¦‚ç‡å‘é‡
probs = np.array([0.5, 0.5, 0.25, 0.25])

# MLEé‡æ„è¿‡ç¨‹
initial_density = get_initial_density(probs)  # åˆå§‹å¯†åº¦çŸ©é˜µ
params = encode_density_to_params(initial_density)  # Choleskyå‚æ•°åŒ–

# ä¼˜åŒ–æ±‚è§£
result = minimize(
    negative_log_likelihood,  # è´Ÿå¯¹æ•°ä¼¼ç„¶
    params,
    method='L-BFGS-B'
)

rho_matrix = decode_params_to_density(result.x)  # (2, 2)

# è¾“å‡ºï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])
```

### **2. å¯†åº¦çŸ©é˜µ â†’ ç‰©ç†é‡**

```python
# è¾“å…¥ï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])

# è®¡ç®—ç‰©ç†é‡
purity = np.trace(density_matrix @ density_matrix)  # 0.75
trace = np.trace(density_matrix)  # 1.0
eigenvalues = np.linalg.eigvalsh(density_matrix)  # [0.146, 0.854]
rank = np.linalg.matrix_rank(density_matrix)  # 2
condition_number = np.linalg.cond(density_matrix)  # æ¡ä»¶æ•°
eigenvalue_entropy = -np.sum(eigenvalues * np.log(eigenvalues + 1e-12))  # ç†µ

# è¾“å‡ºï¼šç‰©ç†é‡å­—å…¸
metrics = {
    "purity": 0.75,
    "trace": 1.0,
    "min_eigenvalue": 0.146,
    "max_eigenvalue": 0.854,
    "rank": 2.0,
    "condition_number": 5.83,
    "eigenvalue_entropy": 0.562
}
```

### **3. å¯†åº¦çŸ©é˜µ â†’ è°±åˆ†è§£ç»“æœ**

```python
# è¾“å…¥ï¼šå¯†åº¦çŸ©é˜µ
density_matrix = np.array([[0.5, 0.5], [0.5, 0.5]])

# è°±åˆ†è§£
eigenvalues, eigenvectors = np.linalg.eigh(density_matrix)
# eigenvalues: [0.146, 0.854]
# eigenvectors: [[-0.707, 0.707], [0.707, 0.707]]

# è¾“å‡ºï¼šè°±åˆ†è§£ç»“æœ
spectral_result = {
    "eigenvalues": [0.146, 0.854],
    "eigenvectors": [[-0.707, 0.707], [0.707, 0.707]],
    "purity": 0.75,
    "rank": 2
}
```

### **4. ç»“æœå¯¹è±¡ â†’ æ–‡ä»¶**

```python
# è¾“å…¥ï¼šé‡æ„ç»“æœ
result = LinearReconstructionResult(
    density=density_matrix,
    residuals=residuals,
    rank=4,
    singular_values=singular_values
)

# åˆ›å»ºè®°å½•
record = ReconstructionRecord(
    method="linear",
    dimension=2,
    design="mub",  # æµ‹é‡åŸºè®¾è®¡
    probabilities=probs,
    density_matrix=density_matrix,
    metrics=metrics,
    metadata={"sample_index": 0}
)

# è¾“å‡ºï¼šJSONæ–‡ä»¶
{
    "method": "linear",
    "dimension": 2,
    "design": "mub",
    "probabilities": [0.5, 0.5, 0.25, 0.25],
    "density_matrix": [[0.5, 0.5], [0.5, 0.5]],
    "metrics": {
        "purity": 0.75,
        "trace": 1.0,
        "rank": 4.0,
        "min_eigenvalue": 0.146,
        "max_eigenvalue": 0.854,
        "condition_number": 5.83,
        "eigenvalue_entropy": 0.562
    }
}
```

---

## ğŸš€ **å®Œæ•´è¿è¡Œæµç¨‹**

### **æ­¥éª¤1ï¼šç”¨æˆ·è¾“å…¥**
```bash
qtomography reconstruct data.csv --method linear,wls,rhor_strict,mle --dimension 4 --design mub
```

### **æ­¥éª¤2ï¼šæ•°æ®åŠ è½½**
```python
# åŠ è½½CSVæ–‡ä»¶
data = pd.read_csv("data.csv")  # shape: (16, 3)
# 16ä¸ªæ¦‚ç‡å€¼ï¼ˆ4Â²ï¼‰ï¼Œ3ä¸ªæ ·æœ¬
```

### **æ­¥éª¤3ï¼šæ‰¹å¤„ç†å¾ªç¯**
```python
for idx in range(3):  # 3ä¸ªæ ·æœ¬
    probs = data[:, idx]  # æå–æ¦‚ç‡å‘é‡
    
    # çº¿æ€§é‡æ„
    if "linear" in methods:
        linear_result = linear.reconstruct_with_details(probs)
    
    # WLSé‡æ„
    if "wls" in methods:
        wls_result = wls.reconstruct_with_details(probs)
    
    # RÏR Stricté‡æ„
    if "rhor_strict" in methods:
        rhor_result = rhor.reconstruct_with_details(probs)
    
    # MLEé‡æ„
    if "mle" in methods:
        mle_result = mle.reconstruct_with_details(probs)
    
    # ä¿å­˜ç»“æœ
    save_record(linear_result)
    save_record(wls_result)
    save_record(rhor_result)
    save_record(mle_result)
    
    # å¯é€‰ï¼šè°±åˆ†è§£åˆ†æ
    if enable_spectral:
        spectral_result = spectral_decomposition.decompose(density)
        save_spectral_report(spectral_result)
```

### **æ­¥éª¤4ï¼šç»“æœæ±‡æ€»**
```python
# ç”ŸæˆCSVæ±‡æ€»
summary_df = pd.DataFrame(summary_rows)
summary_df.to_csv("summary.csv")
# åŒ…å«åˆ—ï¼šsample, method, design, purity, trace, rank, condition_number, ...
```

---

## ğŸ“ **è¾“å‡ºæ–‡ä»¶ç»“æ„**

```
demo_output/
â”œâ”€â”€ records/                          # è¯¦ç»†è®°å½•
â”‚   â”œâ”€â”€ record_4_2025-11-07T14-16-37.json  # æ ·æœ¬0çº¿æ€§é‡æ„
â”‚   â”œâ”€â”€ record_4_2025-11-07T14-16-38.json  # æ ·æœ¬0 WLSé‡æ„
â”‚   â”œâ”€â”€ record_4_2025-11-07T14-16-39.json  # æ ·æœ¬0 RÏR Stricté‡æ„
â”‚   â”œâ”€â”€ record_4_2025-11-07T14-16-40.json  # æ ·æœ¬0 MLEé‡æ„
â”‚   â”œâ”€â”€ record_4_2025-11-07T14-16-41.json  # æ ·æœ¬1çº¿æ€§é‡æ„
â”‚   â””â”€â”€ ...
â”œâ”€â”€ summary.csv                       # æ±‡æ€»æŠ¥å‘Š
â”‚   # åˆ—ï¼šsample, method, design, purity, trace, rank, 
â”‚   #      min_eigenvalue, max_eigenvalue, condition_number,
â”‚   #      eigenvalue_entropy, n_iterations, success
â”œâ”€â”€ spectral_reports/                 # è°±åˆ†è§£æŠ¥å‘Š
â”‚   â”œâ”€â”€ spectral_4_2025-11-07T14-16-37.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ plots/                           # å¯è§†åŒ–å›¾è¡¨
    â”œâ”€â”€ density_heatmap_0.png
    â”œâ”€â”€ amplitude_phase_0.png
    â”œâ”€â”€ spectral_eigenvalues_0.png
    â””â”€â”€ ...
```

---

## ğŸ’¡ **æ•°æ®æµå…³é”®ç‚¹**

### **1. æ•°æ®ç»´åº¦å˜åŒ–**
```
CSV: (16, 3) â†’ æ¦‚ç‡å‘é‡: (16,) â†’ å¯†åº¦çŸ©é˜µ: (4, 4)
```

### **2. æ•°æ®ç±»å‹è½¬æ¢**
```
å­—ç¬¦ä¸² â†’ æµ®ç‚¹æ•° â†’ å¤æ•°çŸ©é˜µ â†’ JSONå­—ç¬¦ä¸²
```

### **3. æ•°æ®æµå‘**
```
æ–‡ä»¶ â†’ å†…å­˜ â†’ è®¡ç®— â†’ å†…å­˜ â†’ æ–‡ä»¶
```

### **4. æ•°æ®éªŒè¯**
```
è¾“å…¥éªŒè¯ â†’ è®¡ç®—éªŒè¯ â†’ ç‰©ç†çº¦æŸéªŒè¯ â†’ è¾“å‡ºéªŒè¯
```

### **5. å¤šç®—æ³•æ•°æ®æµ**
```
åŒä¸€æ¦‚ç‡å‘é‡ â†’ ä¸åŒé‡æ„ç®—æ³• â†’ ä¸åŒå¯†åº¦çŸ©é˜µ â†’ å¯¹æ¯”åˆ†æ
```

### **6. æµ‹é‡åŸºè®¾è®¡å½±å“**
```
ä¸åŒæµ‹é‡åŸºè®¾è®¡ï¼ˆMUB/SIC/NoPOVMï¼‰â†’ ä¸åŒæµ‹é‡çŸ©é˜µ â†’ ä¸åŒé‡æ„ç»“æœ
```

---

## ğŸ¯ **æ€»ç»“**

**æ•°æ®æµæ ¸å¿ƒ**ï¼š
1. **è¾“å…¥**ï¼šCSVæ¦‚ç‡æ•°æ®ï¼ˆæ”¯æŒå¤šç§æµ‹é‡åŸºè®¾è®¡ï¼‰
2. **å¤„ç†**ï¼šå¤šç§é‡æ„ç®—æ³•è®¡ç®—ï¼ˆLinear/WLS/RÏR Strict/MLEï¼‰
3. **è¾“å‡º**ï¼šJSONè®°å½• + CSVæ±‡æ€» + è°±åˆ†è§£æŠ¥å‘Š

**å…³é”®è½¬æ¢**ï¼š
- æ¦‚ç‡å‘é‡ â†’ å¯†åº¦çŸ©é˜µï¼ˆå››ç§ç®—æ³•ï¼‰
- å¯†åº¦çŸ©é˜µ â†’ ç‰©ç†é‡ï¼ˆæ‰©å±•æŒ‡æ ‡ï¼‰
- å¯†åº¦çŸ©é˜µ â†’ è°±åˆ†è§£ç»“æœ
- ç»“æœå¯¹è±¡ â†’ æ–‡ä»¶æ ¼å¼

**æµç¨‹æ§åˆ¶**ï¼š
- CLIå±‚ï¼šå‚æ•°è§£æï¼ˆæ”¯æŒmethodå’Œdesignå‚æ•°ï¼‰
- åº”ç”¨å±‚ï¼šæ‰¹å¤„ç†æ§åˆ¶ï¼ˆå¤šç®—æ³•æ”¯æŒï¼‰
- é¢†åŸŸå±‚ï¼šç®—æ³•è®¡ç®—ï¼ˆå››ç§é‡æ„ç®—æ³•ï¼‰
- åŸºç¡€è®¾æ–½å±‚ï¼šç»“æœæŒä¹…åŒ–ï¼ˆJSON/CSV/è°±åˆ†è§£æŠ¥å‘Šï¼‰

**æ–°å¢ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒå››ç§é‡æ„ç®—æ³•ï¼ˆLinearã€WLSã€RÏR Strictã€MLEï¼‰
- âœ… æ”¯æŒä¸‰ç§æµ‹é‡åŸºè®¾è®¡ï¼ˆMUBã€SICã€NoPOVMï¼‰
- âœ… æ‰©å±•çš„ç‰©ç†é‡æŒ‡æ ‡ï¼ˆrankã€condition_numberã€eigenvalue_entropyç­‰ï¼‰
- âœ… è°±åˆ†è§£åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ

è®°ä½ï¼š**æ•°æ®åœ¨æ¯ä¸€å±‚éƒ½ä¼šå‘ç”Ÿè½¬æ¢ï¼Œä½†æ ¸å¿ƒçš„è®¡ç®—é€»è¾‘åœ¨é¢†åŸŸå±‚çš„é‡æ„å™¨ä¸­ï¼ç°åœ¨æ”¯æŒå¤šç§ç®—æ³•å’Œæµ‹é‡åŸºè®¾è®¡çš„çµæ´»ç»„åˆï¼**
