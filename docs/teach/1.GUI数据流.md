æˆ‘æ¥ä¸ºä½ è¯¦ç»†åˆ†æGUIæ“ä½œçš„å®Œæ•´æ•°æ®æµï¼Œä»ç”¨æˆ·ç‚¹å‡»è¿è¡Œåˆ°ç»“æœæ˜¾ç¤ºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚


[8 tools called]

ç°åœ¨æˆ‘æ¥ä¸ºä½ è¯¦ç»†åˆ†æGUIæ“ä½œçš„å®Œæ•´æ•°æ®æµï¼š

# ğŸ¯ GUIæ“ä½œå®Œæ•´æ•°æ®æµåˆ†æ

## ğŸ“‹ æ•°æ®æµæ¦‚è§ˆ

GUIçš„æ•°æ®æµå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š
1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼šç•Œé¢ç»„ä»¶åˆ›å»ºå’Œä¿¡å·è¿æ¥
2. **æ•°æ®å‡†å¤‡é˜¶æ®µ**ï¼šç”¨æˆ·é€‰æ‹©æ–‡ä»¶å’Œé…ç½®å‚æ•°
3. **ä»»åŠ¡æ‰§è¡Œé˜¶æ®µ**ï¼šç‚¹å‡»è¿è¡Œåçš„å¼‚æ­¥å¤„ç†
4. **ç»“æœå±•ç¤ºé˜¶æ®µ**ï¼šè¿›åº¦æ›´æ–°å’Œç»“æœæ˜¾ç¤º

## ğŸ”„ è¯¦ç»†æ•°æ®æµåˆ†æ

### 1. åˆå§‹åŒ–é˜¶æ®µæ•°æ®æµ

```mermaid
sequenceDiagram
    participant App as app.py
    participant MainWindow as main_window.py
    participant Panels as panels/
    participant Runner as controller_runner.py
    
    App->>MainWindow: åˆ›å»ºä¸»çª—å£
    MainWindow->>Panels: åˆ›å»ºå„ä¸ªé¢æ¿ç»„ä»¶
    MainWindow->>Runner: åˆ›å»ºæ§åˆ¶å™¨è¿è¡Œå™¨
    MainWindow->>MainWindow: è¿æ¥ä¿¡å·æ§½
    Note over MainWindow: å»ºç«‹GUIç»„ä»¶é—´çš„é€šä¿¡æœºåˆ¶
```

**å…³é”®ä»£ç **ï¼š
```python
# app.py
def main():
    app = QtWidgets.QApplication(argv)
    window = MainWindow()  # åˆ›å»ºä¸»çª—å£
    window.show()
    return app.exec()

# main_window.py
def __init__(self):
    # åˆ›å»ºå„ä¸ªé¢æ¿
    self.data_panel = DataPanel()
    self.config_panel = ConfigPanel()
    self.execute_panel = ExecutePanel()
    self.progress_panel = ProgressPanel()
    self.summary_panel = SummaryPanel()
    self.figure_panel = FigurePanel()
    
    # åˆ›å»ºæ§åˆ¶å™¨è¿è¡Œå™¨
    self._runner = ControllerRunner(self)
    
    # è¿æ¥ä¿¡å·æ§½
    self._connect_execute_panel()
```

### 2. æ•°æ®å‡†å¤‡é˜¶æ®µæ•°æ®æµ

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant DataPanel as data_panel.py
    participant ConfigPanel as config_panel.py
    participant MainWindow as main_window.py
    
    User->>DataPanel: ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"
    DataPanel->>DataPanel: æ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†
    DataPanel->>DataPanel: è®¾ç½®æ–‡ä»¶è·¯å¾„
    DataPanel->>MainWindow: å‘å°„dataset_changedä¿¡å·
    Note over DataPanel: æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
    
    User->>ConfigPanel: è®¾ç½®å‚æ•°
    ConfigPanel->>ConfigPanel: æ›´æ–°å†…éƒ¨çŠ¶æ€
    Note over ConfigPanel: å‚æ•°éªŒè¯å’Œå­˜å‚¨
```

**å…³é”®ä»£ç **ï¼š
```python
# data_panel.py
def _browse_file(self):
    path, _ = QtWidgets.QFileDialog.getOpenFileName(...)
    if path:
        self.set_file(Path(path))

def set_file(self, path: Path):
    self._current_file = path
    self.path_edit.setText(str(path))
    # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
    self.dataset_changed.emit(path)  # å‘å°„ä¿¡å·

# config_panel.py
def build_config_kwargs(self, dataset_path: Path) -> Dict:
    # ä»ç•Œé¢æ§ä»¶æ”¶é›†å‚æ•°
    methods = []
    if self.linear_checkbox.isChecked():
        methods.append("linear")
    if self.mle_checkbox.isChecked():
        methods.append("mle")
    
    return {
        "input_path": dataset_path,
        "methods": tuple(methods),
        "dimension": self.dimension_spin.value(),
        # ... å…¶ä»–å‚æ•°
    }
```

### 3. ä»»åŠ¡æ‰§è¡Œé˜¶æ®µæ•°æ®æµ

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant ExecutePanel as execute_panel.py
    participant MainWindow as main_window.py
    participant Runner as controller_runner.py
    participant Controller as ReconstructionController
    participant ProgressPanel as progress_panel.py
    participant SummaryPanel as summary_panel.py
    
    User->>ExecutePanel: ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®
    ExecutePanel->>MainWindow: å‘å°„run_requestedä¿¡å·
    MainWindow->>MainWindow: _trigger_run()
    MainWindow->>ConfigPanel: æ”¶é›†é…ç½®å‚æ•°
    MainWindow->>Runner: start(config, output_dir)
    
    Runner->>Runner: åˆ›å»ºå–æ¶ˆäº‹ä»¶
    Runner->>Runner: å‘å°„startedä¿¡å·
    Runner->>Controller: run_batch_async()
    
    Note over MainWindow: æ›´æ–°ç•Œé¢çŠ¶æ€
    MainWindow->>ExecutePanel: set_running(True)
    MainWindow->>ProgressPanel: reset()
    MainWindow->>SummaryPanel: clear()
    
    loop å¤„ç†è¿‡ç¨‹ä¸­
        Controller->>Runner: è¿›åº¦å›è°ƒ
        Runner->>MainWindow: å‘å°„progressä¿¡å·
        MainWindow->>ProgressPanel: update_event()
        ProgressPanel->>ProgressPanel: æ›´æ–°è¿›åº¦æ¡å’Œæ—¥å¿—
    end
    
    Controller->>Runner: ä»»åŠ¡å®Œæˆ
    Runner->>MainWindow: å‘å°„finishedä¿¡å·
    MainWindow->>SummaryPanel: load_summary()
    MainWindow->>ExecutePanel: set_running(False)
```

**å…³é”®ä»£ç **ï¼š
```python
# execute_panel.py
def _build_ui(self):
    self.run_button = QtWidgets.QPushButton("è¿è¡Œ")
    self.run_button.clicked.connect(self.run_requested)  # è¿æ¥ä¿¡å·

# main_window.py
def _connect_execute_panel(self):
    self.execute_panel.run_requested.connect(self._trigger_run)

def _trigger_run(self):
    config = self._build_config()  # æ”¶é›†é…ç½®
    if config is None:
        return
    self._runner.start(config, config.output_dir)  # å¯åŠ¨ä»»åŠ¡

# controller_runner.py
def start(self, config, output_dir):
    self._cancel_event = Event()
    self.started.emit()  # å‘å°„å¼€å§‹ä¿¡å·
    
    self._future = self._controller.run_batch_async(
        config,
        progress_callback=self._emit_progress,  # è¿›åº¦å›è°ƒ
        cancel_event=self._cancel_event,
    )
    self._future.add_done_callback(self._handle_done)

def _emit_progress(self, event: ProgressEvent):
    self.progress.emit(event)  # å‘å°„è¿›åº¦ä¿¡å·
```

### 4. è¿›åº¦æ›´æ–°æ•°æ®æµ

```mermaid
sequenceDiagram
    participant Controller as ReconstructionController
    participant Runner as controller_runner.py
    participant MainWindow as main_window.py
    participant ProgressPanel as progress_panel.py
    
    Controller->>Runner: è¿›åº¦å›è°ƒå‡½æ•°
    Runner->>Runner: _emit_progress(event)
    Runner->>MainWindow: å‘å°„progressä¿¡å·
    MainWindow->>MainWindow: _on_runner_progress()
    MainWindow->>ProgressPanel: update_event()
    ProgressPanel->>ProgressPanel: æ›´æ–°è¿›åº¦æ¡
    ProgressPanel->>ProgressPanel: æ›´æ–°çŠ¶æ€æ ‡ç­¾
    ProgressPanel->>ProgressPanel: æ·»åŠ æ—¥å¿—æ¶ˆæ¯
```

**å…³é”®ä»£ç **ï¼š
```python
# main_window.py
def _on_runner_progress(self, progress: ProgressEvent):
    self.progress_panel.update_event(progress)

# progress_panel.py
def update_event(self, event: ProgressEvent):
    percent = int(event.fraction * 100)
    self.progress_bar.setValue(percent)
    self.stage_label.setText(f"çŠ¶æ€: {event.stage}")
    if event.sample_index is not None:
        self.sample_label.setText(f"æ ·æœ¬: {event.sample_index + 1}/{event.total_samples}")
    
    if event.message:
        self._append_log(event.message)
```

### 5. ç»“æœå±•ç¤ºæ•°æ®æµ

```mermaid
sequenceDiagram
    participant Controller as ReconstructionController
    participant Runner as controller_runner.py
    participant MainWindow as main_window.py
    participant SummaryPanel as summary_panel.py
    participant FigurePanel as figure_panel.py
    
    Controller->>Runner: ä»»åŠ¡å®Œæˆ
    Runner->>Runner: _handle_done()
    Runner->>MainWindow: å‘å°„finishedä¿¡å·
    MainWindow->>MainWindow: _on_runner_finished()
    MainWindow->>SummaryPanel: load_summary()
    MainWindow->>FigurePanel: æ˜¾ç¤ºç»“æœå›¾åƒ
    MainWindow->>ExecutePanel: set_running(False)
```

**å…³é”®ä»£ç **ï¼š
```python
# main_window.py
def _on_runner_finished(self, result):
    self.action_run.setEnabled(True)
    self.action_cancel.setEnabled(False)
    self.execute_panel.set_running(False)
    
    # åŠ è½½ç»“æœ
    summary_path = self._current_result_dir / "summary.csv"
    if summary_path.exists():
        self.summary_panel.load_summary(summary_path)

# summary_panel.py
def load_summary(self, path: Path):
    df = pd.read_csv(path)
    self._model.clear()
    self._model.setHorizontalHeaderLabels(df.columns.tolist())
    
    for _, row in df.iterrows():
        items = [QtGui.QStandardItem(str(row[col])) for col in df.columns]
        self._model.appendRow(items)
```

## ğŸ¯ å…³é”®æ•°æ®æµç‰¹ç‚¹

### 1. ä¿¡å·æ§½æœºåˆ¶
- **è§£è€¦è®¾è®¡**ï¼šç»„ä»¶é—´é€šè¿‡ä¿¡å·æ§½é€šä¿¡ï¼Œé™ä½è€¦åˆåº¦
- **å¼‚æ­¥å¤„ç†**ï¼šGUIä¸é˜»å¡ï¼Œç”¨æˆ·ä½“éªŒå¥½
- **äº‹ä»¶é©±åŠ¨**ï¼šå“åº”å¼ç•Œé¢è®¾è®¡

### 2. æ•°æ®æµå‘
```
ç”¨æˆ·æ“ä½œ â†’ ç•Œé¢ç»„ä»¶ â†’ ä¿¡å·å‘å°„ â†’ ä¸»çª—å£å¤„ç† â†’ ä¸šåŠ¡é€»è¾‘ â†’ ç»“æœæ›´æ–° â†’ ç•Œé¢æ˜¾ç¤º
```

### 3. çŠ¶æ€ç®¡ç†
- **è¿è¡ŒçŠ¶æ€**ï¼šé€šè¿‡`set_running()`æ§åˆ¶æŒ‰é’®çŠ¶æ€
- **è¿›åº¦çŠ¶æ€**ï¼šå®æ—¶æ›´æ–°è¿›åº¦æ¡å’ŒçŠ¶æ€ä¿¡æ¯
- **ç»“æœçŠ¶æ€**ï¼šåŠ¨æ€åŠ è½½å’Œæ˜¾ç¤ºç»“æœ

### 4. é”™è¯¯å¤„ç†
- **å‚æ•°éªŒè¯**ï¼šé…ç½®é¢æ¿éªŒè¯ç”¨æˆ·è¾“å…¥
- **å¼‚å¸¸æ•è·**ï¼šè¿è¡Œå™¨æ•è·å’Œè½¬å‘å¼‚å¸¸
- **ç”¨æˆ·æç¤º**ï¼šé€šè¿‡æ¶ˆæ¯æ¡†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

è¿™ä¸ªæ•°æ®æµè®¾è®¡ä½“ç°äº†ç°ä»£GUIåº”ç”¨çš„æœ€ä½³å®è·µï¼š**MVCæ¨¡å¼**ã€**ä¿¡å·æ§½æœºåˆ¶**ã€**å¼‚æ­¥å¤„ç†**å’Œ**å“åº”å¼æ›´æ–°**ï¼Œç¡®ä¿äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œä»£ç å¯ç»´æŠ¤æ€§ã€‚