è®©æˆ‘å¸®ä½ æ¢³ç†ä¸€ä¸‹é‡æ„å™¨çš„è®¡ç®—æµç¨‹ï¼Œç¡®å®å®¹æ˜“æ··ä¹±ï¼è®©æˆ‘ä»å…¥å£å¼€å§‹è¿½è¸ªæ•´ä¸ªè®¡ç®—è¿‡ç¨‹ã€‚


[2 tools called]

ç°åœ¨è®©æˆ‘æŸ¥çœ‹å…·ä½“çš„è®¡ç®—å¯åŠ¨ç‚¹ï¼š


[2 tools called]

ç°åœ¨è®©æˆ‘æŸ¥çœ‹å…·ä½“çš„è®¡ç®—å¯åŠ¨ç‚¹ï¼š


[2 tools called]

ç°åœ¨æˆ‘æ˜ç™½äº†ï¼è®©æˆ‘ä¸ºä½ æ¢³ç†æ¸…æ¥šé‡æ„å™¨çš„è®¡ç®—å¯åŠ¨æµç¨‹ï¼š

# ğŸš€ **é‡æ„å™¨è®¡ç®—å¯åŠ¨æµç¨‹è¯¦è§£**

## ğŸ“‹ **å®Œæ•´è°ƒç”¨é“¾è·¯**

### **1. ç”¨æˆ·å…¥å£ï¼ˆCLIï¼‰**
```bash
# ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥
qtomography reconstruct data.csv --method both --dimension 4
```

### **2. CLIå±‚å¤„ç†**
```python
# qtomography/cli/main.py
def _cmd_reconstruct(args):
    # è§£æå‚æ•°ï¼Œæ„å»ºé…ç½®
    config = ReconstructionConfig(
        input_path=input_path,
        methods=["linear", "mle"],
        dimension=4,
        # ... å…¶ä»–å‚æ•°
    )
    
    # è°ƒç”¨åº”ç”¨å±‚
    result = run_batch(config)  # â† è¿™é‡Œå¼€å§‹çœŸæ­£çš„è®¡ç®—
```

### **3. åº”ç”¨å±‚æ§åˆ¶å™¨**
```python
# qtomography/app/controller.py
def run_batch(config: ReconstructionConfig):
    controller = ReconstructionController()
    return controller.run_batch(config)  # â† è¿›å…¥æ§åˆ¶å™¨
```

### **4. æ§åˆ¶å™¨æ ¸å¿ƒé€»è¾‘**
```python
# qtomography/app/controller.py - run_batchæ–¹æ³•
def run_batch(self, config: ReconstructionConfig):
    # [1] åŠ è½½æ•°æ®
    data = _load_probabilities(config.input_path, config.sheet)
    
    # [2] åˆ›å»ºé‡æ„å™¨å®ä¾‹
    linear = LinearReconstructor(dimension, tolerance, ...)
    mle = MLEReconstructor(dimension, tolerance, ...)
    
    # [3] æ‰¹å¤„ç†å¾ªç¯ - è¿™é‡Œæ˜¯çœŸæ­£çš„è®¡ç®—å¯åŠ¨ç‚¹ï¼
    for idx in range(sample_count):
        probs = data[:, idx]  # æå–å½“å‰æ ·æœ¬çš„æ¦‚ç‡å‘é‡
        
        # çº¿æ€§é‡æ„è®¡ç®—å¯åŠ¨
        if linear is not None:
            linear_result = linear.reconstruct_with_details(probs)  # â† è®¡ç®—å¯åŠ¨ï¼
        
        # MLEé‡æ„è®¡ç®—å¯åŠ¨  
        if mle is not None:
            mle_result = mle.reconstruct_with_details(probs)  # â† è®¡ç®—å¯åŠ¨ï¼
```

## ğŸ¯ **çœŸæ­£çš„è®¡ç®—å¯åŠ¨ç‚¹**

### **å…³é”®ä»£ç ä½ç½®**
```python
# åœ¨ controller.py çš„ç¬¬700è¡Œå’Œç¬¬849è¡Œ
linear_result = linear.reconstruct_with_details(probs)  # çº¿æ€§é‡æ„å¯åŠ¨
mle_result = mle.reconstruct_with_details(probs)        # MLEé‡æ„å¯åŠ¨
```

### **è®¡ç®—æµç¨‹è¯¦è§£**

#### **1. çº¿æ€§é‡æ„è®¡ç®—å¯åŠ¨**
```python
# qtomography/domain/reconstruction/linear.py
def reconstruct_with_details(self, probabilities):
    # [1] å½’ä¸€åŒ–æ¦‚ç‡
    probs = self._normalize_probabilities(probabilities)
    
    # [2] è·å–æµ‹é‡çŸ©é˜µ
    measurement_matrix = self.projector_set.measurement_matrix
    
    # [3] æ‰§è¡Œæœ€å°äºŒä¹˜æ±‚è§£ - è¿™é‡Œæ˜¯çœŸæ­£çš„æ•°å€¼è®¡ç®—ï¼
    if self.regularization is None:
        rho_vec, residuals, rank, singular_values = np.linalg.lstsq(
            measurement_matrix, probs, rcond=None
        )
    else:
        # å²­å›å½’æ±‚è§£
        rho_vec = np.linalg.solve(mtm + lambda_eye, right_hand)
    
    # [4] é‡æ„å¯†åº¦çŸ©é˜µ
    rho = self._vec_to_density_matrix(rho_vec)
    
    # [5] ç‰©ç†åŒ–å¤„ç†
    rho_physical = rho.sanitize_within_tol()
    
    return LinearReconstructionResult(...)
```

#### **2. MLEé‡æ„è®¡ç®—å¯åŠ¨**
```python
# qtomography/domain/reconstruction/mle.py
def reconstruct_with_details(self, probabilities, initial_density=None):
    # [1] å½’ä¸€åŒ–æ¦‚ç‡
    probs = self._normalize_probabilities(probabilities)
    
    # [2] è·å–åˆå§‹å¯†åº¦çŸ©é˜µ
    if initial_density is None:
        initial_density = self._get_initial_density(probs)
    
    # [3] æ‰§è¡ŒMLEä¼˜åŒ– - è¿™é‡Œæ˜¯çœŸæ­£çš„æ•°å€¼è®¡ç®—ï¼
    result = minimize(
        self._negative_log_likelihood,
        initial_density,
        method='L-BFGS-B',
        jac=self._gradient,
        options={'maxiter': self.max_iterations}
    )
    
    # [4] é‡æ„å¯†åº¦çŸ©é˜µ
    rho = self._decode_params_to_density(result.x)
    
    # [5] ç‰©ç†åŒ–å¤„ç†
    rho_physical = rho.sanitize_within_tol()
    
    return MLEReconstructionResult(...)
```

## ğŸ” **ä¸ºä»€ä¹ˆæ„Ÿè§‰"å…¨æ˜¯åˆ›å»ºç±»"ï¼Ÿ**

### **åŸå› åˆ†æ**
1. **åˆ†å±‚æ¶æ„**ï¼šæ¯å±‚éƒ½æœ‰å¯¹åº”çš„ç±»
2. **é…ç½®å¯¹è±¡**ï¼š`ReconstructionConfig` ä¼ é€’å‚æ•°
3. **ç»“æœå¯¹è±¡**ï¼š`LinearReconstructionResult` å°è£…ç»“æœ
4. **å·¥å‚æ¨¡å¼**ï¼šåŠ¨æ€åˆ›å»ºé‡æ„å™¨å®ä¾‹

### **ä½†çœŸæ­£çš„è®¡ç®—åœ¨è¿™é‡Œ**
```python
# çœŸæ­£çš„æ•°å€¼è®¡ç®—å‘ç”Ÿåœ¨è¿™ä¸¤è¡Œï¼š
linear_result = linear.reconstruct_with_details(probs)  # æœ€å°äºŒä¹˜æ±‚è§£
mle_result = mle.reconstruct_with_details(probs)        # ä¼˜åŒ–æ±‚è§£
```

## ğŸ’¡ **è®¡ç®—å¯åŠ¨çš„å…³é”®ç‚¹**

### **1. æ•°æ®å‡†å¤‡**
```python
# ä»CSV/ExcelåŠ è½½æ¦‚ç‡æ•°æ®
data = _load_probabilities(config.input_path, config.sheet)
probs = data[:, idx]  # æå–å•ä¸ªæ ·æœ¬çš„æ¦‚ç‡å‘é‡
```

### **2. é‡æ„å™¨å®ä¾‹åŒ–**
```python
# åˆ›å»ºé‡æ„å™¨ï¼ˆåªæ˜¯å‡†å¤‡ï¼Œè¿˜æ²¡è®¡ç®—ï¼‰
linear = LinearReconstructor(dimension, tolerance, ...)
mle = MLEReconstructor(dimension, tolerance, ...)
```

### **3. è®¡ç®—å¯åŠ¨**
```python
# è¿™é‡Œæ‰æ˜¯çœŸæ­£çš„è®¡ç®—å¼€å§‹ï¼
linear_result = linear.reconstruct_with_details(probs)
mle_result = mle.reconstruct_with_details(probs)
```

## ğŸ¯ **æ€»ç»“**

**è®¡ç®—å¯åŠ¨çš„çœŸæ­£ä½ç½®**ï¼š
- **æ–‡ä»¶**ï¼š`qtomography/app/controller.py`
- **æ–¹æ³•**ï¼š`run_batch()` ä¸­çš„å¾ªç¯
- **è¡Œå·**ï¼šç¬¬700è¡Œï¼ˆçº¿æ€§ï¼‰å’Œç¬¬849è¡Œï¼ˆMLEï¼‰
- **å…³é”®è°ƒç”¨**ï¼š`reconstruct_with_details(probs)`

**ä¸ºä»€ä¹ˆæ„Ÿè§‰æ··ä¹±**ï¼š
- åˆ†å±‚æ¶æ„å¯¼è‡´å¾ˆå¤šç±»
- é…ç½®å’Œç»“æœéƒ½ç”¨ç±»å°è£…
- ä½†çœŸæ­£çš„æ•°å€¼è®¡ç®—å°±åœ¨é‚£ä¸¤è¡Œï¼

**è®°ä½**ï¼šæ‰€æœ‰çš„ç±»åˆ›å»ºéƒ½æ˜¯ä¸ºäº†å‡†å¤‡è®¡ç®—ç¯å¢ƒï¼ŒçœŸæ­£çš„è®¡ç®—å¯åŠ¨åœ¨ `reconstruct_with_details()` æ–¹æ³•ä¸­ï¼