# MUB实现支持的维度分析

## 1. 理论支持范围

**理论上**，MUB应该支持所有**素数幂维度**：
- 形式：d = p^k，其中 p 是素数，k ≥ 1
- 例如：2, 3, 4(2²), 5, 7, 8(2³), 9(3²), 11, 13, 16(2⁴), 17, 19, 23, 25(5²), 27(3³), ...

## 2. 当前实现支持情况

### 2.1 后端选择机制

代码使用 `_get_field_backend(d)` 选择后端：
1. **优先使用 `_GaloisBackend`**（如果安装了 `galois` 库）
   - 支持所有素数幂维度（理论上）
   - 使用标准库实现，更可靠

2. **回退到 `_MinimalGFBackend`**（如果 `galois` 库不可用）
   - 只实现了有限的 GF(p^k) 情况

### 2.2 _MinimalGFBackend 支持的具体情况

根据代码（第111-120行），`_MinimalGFBackend` 支持：

| p | k | d = p^k | 状态 | 说明 |
|---|---|---------|------|------|
| 任意素数 | 1 | p | ✅ 支持 | 所有素数维度 |
| 2 | 2 | 4 | ✅ 支持 | GF(2²)，不可约多项式 x²+x+1 |
| 2 | 4 | 16 | ✅ 支持 | GF(2⁴)，不可约多项式 x⁴+x+1 |
| 3 | 2 | 9 | ✅ 支持 | GF(3²)，不可约多项式 x²+1 |
| 其他 | - | - | ❌ 不支持 | 会抛出 `NotImplementedError` |

### 2.3 构造方法支持

#### method='wh' (Weyl-Heisenberg构造)
- **奇数特征 (p > 2)**：使用 `_build_bases_ff`（有限域公式）
- **特征2 (p = 2)**：使用 `_build_bases_pow2_stabilizer`（Stabilizer/Pauli构造）

**支持情况**：
- ✅ 如果安装了 `galois` 库：支持所有素数幂维度
- ⚠️ 如果只有 `_MinimalGFBackend`：
  - 支持：所有素数 (p¹)，d=4 (2²)，d=9 (3²)，d=16 (2⁴)
  - 不支持：其他情况（如 d=25 (5²), d=27 (3³), d=8 (2³) 等）

#### method='ff' (有限域公式)
- **仅支持奇数特征 (p > 2)**
- 不支持特征2 (p = 2)

**支持情况**：
- ✅ 如果安装了 `galois` 库：支持所有奇数特征的素数幂维度
- ⚠️ 如果只有 `_MinimalGFBackend`：
  - 支持：所有奇素数 (p¹)，d=9 (3²)
  - 不支持：其他情况（如 d=25 (5²), d=27 (3³) 等）

## 3. 实际支持的维度列表

### 3.1 使用 galois 库时（推荐）

**完全支持**（所有素数幂维度）：
- **素数维度**：2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, ...
- **2的幂次**：4, 8, 16, 32, 64, ...
- **3的幂次**：9, 27, 81, ...
- **5的幂次**：25, 125, ...
- **其他素数幂**：49(7²), 121(11²), ...

### 3.2 不使用 galois 库时（仅 _MinimalGFBackend）

**method='wh' 支持**：
- 所有素数：2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, ...
- d=4 (2²)
- d=9 (3²)
- d=16 (2⁴)

**method='ff' 支持**：
- 所有奇素数：3, 5, 7, 11, 13, 17, 19, 23, 29, 31, ...
- d=9 (3²)

**不支持**（会抛出 `NotImplementedError`）：
- d=8 (2³)
- d=25 (5²)
- d=27 (3³)
- d=32 (2⁵)
- 其他所有未列出的素数幂

## 4. 合理性评估

### ✅ 合理的设计

1. **理论正确性**：
   - 只支持素数幂维度是正确的（符合MUB理论）
   - 正确拒绝非素数幂维度（如 d=6, 10, 12 等）

2. **分层设计**：
   - 优先使用 `galois` 库（标准、可靠）
   - 回退到最小实现（保证基本功能）

3. **方法选择**：
   - `method='wh'` 支持所有素数幂（包括 p=2）
   - `method='ff'` 仅支持奇数特征（符合理论限制）

### ⚠️ 需要改进的地方

1. **`_MinimalGFBackend` 覆盖不足**：
   - 当前只支持 4 种 GF(p^k) 情况
   - 对于 d=8, 25, 27 等常见维度无法支持
   - **建议**：扩展更多不可约多项式，或推荐用户安装 `galois` 库

2. **错误消息不明确**：
   - 当 `_MinimalGFBackend` 不支持时，错误消息是 `NotImplementedError`
   - **建议**：提供更友好的错误消息，提示安装 `galois` 库

3. **文档不完整**：
   - 没有明确说明哪些维度需要 `galois` 库
   - **建议**：在文档中列出支持的维度范围

## 5. 建议

### 短期改进
1. 在 `build_mub_projectors` 的文档字符串中明确说明：
   - 哪些维度需要 `galois` 库
   - 哪些维度可以用 `_MinimalGFBackend`
   - 推荐安装 `galois` 库以获得完整支持

2. 改进错误消息：
   ```python
   except NotImplementedError:
       raise NotImplementedError(
           f"GF({p}^{k}) not implemented in fallback backend. "
           f"Please install 'galois' library for full support: pip install galois"
       )
   ```

### 长期改进
1. 扩展 `_MinimalGFBackend` 支持更多常见维度：
   - d=8 (2³)
   - d=25 (5²)
   - d=27 (3³)
   - d=32 (2⁵)

2. 或完全依赖 `galois` 库，移除 `_MinimalGFBackend`

## 6. 当前实现状态（2025年1月更新）

### 已修复的问题
1. ✅ **galois库API兼容性**：已修复 `_GaloisBackend` 以适配galois 0.4.6版本
2. ✅ **特征2支持**：实现了 `_build_bases_pow2_stabilizer`，支持d=2, 4, 8, 16, 32...
3. ✅ **完整维度支持**：安装galois库后，支持所有素数幂维度

### 支持情况总结

| 维度类型 | 使用galois库 | 不使用galois库 | 状态 |
|---------|-------------|---------------|------|
| 素数维度 | ✅ 全部支持 | ✅ 全部支持 | ✅ 完全支持 |
| 2的幂次 (d≥2) | ✅ 全部支持 | ⚠️ 仅 d=2,4,16 | ✅ 已实现stabilizer构造 |
| 3的幂次 (d≥9) | ✅ 全部支持 | ⚠️ 仅 d=9 | ⚠️ 需galois库 |
| 其他素数幂 | ✅ 全部支持 | ❌ 不支持 | ⚠️ 需galois库 |

**总体评估**：设计合理，已修复关键问题。**强烈建议用户安装 `galois` 库以获得完整的维度支持**。

### 安装galois库

```bash
pip install galois
```

安装后即可支持所有素数幂维度。

