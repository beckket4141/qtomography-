# WLS 配置化落地方案

## 后端参数
- `qtomography/domain/reconstruction/wls.py` 暴露 `min_expected_clip`（默认 `1e-12`）与 `optimizer_ftol`（默认 `1e-9`），分别用于限制极小理论概率的权重和控制 L-BFGS-B 的收敛准则。
- `ReconstructionConfig` 及其 JSON 序列化（`qtomography/app/config_io.py`）保存 `wls_min_expected_clip` 与 `wls_optimizer_ftol`，CLI/GUI 统一走这层配置。
- CLI 新增 `--wls-min-expected-clip` 与 `--wls-ftol` 参数，可独立覆盖配置文件中的默认值；保存配置时同样写入。

## GUI 交互
- Config 面板新增两个数值输入框：
  - “WLS 最小概率裁剪”（`1e-12` ~ `1e-3`，默认 `1e-12`）；
  - “WLS ftol”（`1e-12` ~ `1e-3`，默认 `1e-9`）。
- 这些控件会在 WLS 勾选状态下自动启用/禁用，同时写入 `GUIConfig.ConfigConfig`，确保下次启动时记忆用户的选择。

## 使用指引
1. **GUI**：在 “WLS” 小节展开后即可直接修改裁剪阈值与 `ftol`，点击保存/运行时写入 `ReconstructionConfig`。
2. **CLI**：
   ```bash
   qtomography reconstruct data.csv \
     --wls-min-expected-clip 1e-10 \
     --wls-ftol 5e-9
   ```
3. **配置文件**：`wls_min_expected_clip` 和 `wls_optimizer_ftol` 字段可写入 JSON，GUI/CLI 共享同一份配置。

## 验证
- 单元测试 `tests/unit/test_config_io.py` 覆盖新字段的序列化、默认值与非法输入校验。
- GUI 加载/保存逻辑通过 `ConfigPanel` & `GUIConfig` 的新字段进行手动验收：
  - 切换 WLS 复选框验证控件启用状态；
  - 保存配置后重新打开，确保值被正确还原。
