**后端现状**

* 重构流水线（Controller + Linear/WLS/RρR）支持多算法、Bell 指标、JSON/Summary 输出。
* 统一文件/密度矩阵加载（CSV/Excel/MAT/JSON），ResultRepository 便于读写记录。
* 谱分解完整落地：SpectralRunner（QThread）、SpectralResult、振幅/相位图、文本/JSON 报告、summary 写入。
* GUI 配置持久化（GUIConfig + Repository）涵盖谱分解、数据面板、窗口状态。

**用户目标**

* 快速从测量数据到密度矩阵，筛查异常样本。
* 方便地比较不同重构算法/参数并查看指标与图像。
* 对任意密度矩阵运行谱分解、获取振幅/相位图、文本报告，与 MATLAB 结果对齐。
* 批量运行任务（重构或谱分解）而不会卡死 GUI。
* 在演示/教学中需要视图灵活、可同时观察配置/日志/图像。

**GUI 设计方案**

1. **模式结构**
   * 顶部保留“重构”和“谱分解”两大模式；切换时加载对应的 Dock 布局。
   * 默认开启 Dock 模式（**QDockWidget**），以左/右/下分区呈现；提供“简洁模式”一键恢复固定布局。
   * 任务队列面板全局共享，列出所有后台作业（重构/谱分解），显示状态、耗时、取消按钮。
2. **重构模式布局**
   * **数据 Dock** ：目录树+文件列表，支持拖拽、多选，显示文件大小/更新时间。
   * **配置 Dock** ：按模块（测量配置、算法选择、正则参数、Bell 分析）分组，支持保存 preset。
   * **执行 Dock** ：输出目录、批量任务列表、Start/Stop、预计耗时。
   * **Summary Dock** ：可排序/过滤的表格，双击行可在图像 Dock 打开对应记录。
   * **图像 Dock** ：新 viewer 支持多图类型（热力图、3D 柱状、振幅/相位等）勾选切换，按钮式导出；双击或按钮全屏。
   * **日志/进度 Dock** ：实时显示控制器事件、错误、Bell 分析结果；底部状态栏同步摘要。
3. **谱分解模式布局**
   * **文件 Dock** ：文件夹浏览、扩展名筛选，可直接加载重构输出目录（自动抓取 JSON）。
   * **谱分解参数 Dock** ：维度提示、理论态选择、自定义系数/相位编辑器（附预览图），保存常用模板。
   * **任务控制 Dock** ：自定义输出目录、复选项（保存文本/JSON/图像）、格式/DPI 调整。
   * **结果 Dock** ：表格展示每个文件的维度、最大特征值、保真度、输出路径；双击打开振幅/相位图或报告；图像 Viewer 支持多种视图（振幅、相位、纯态向量）。
   * **日志 Dock** ：SpectralRunner 日志、错误、耗时。
   * **任务队列** ：跨模式共用，确保后台线程处理，GUI 不阻塞。
4. **图像 Viewer 重新实现**
   * 自定义 **ViewerWidget**（继承 QGraphicsView）处理缩放、拖拽、右键菜单、全屏、导出；支持勾选显示内容（实部热力图、虚部热力图、3D 柱状、振幅、相位、Bell 分布等）。
   * 全屏使用非模态窗口 + **showFullScreen()**，提供工具栏（退出、保存、切换图像）。
   * “保存图像”沿用用户选择的格式与 DPI。
5. **任务队列/后台执行**
   * 把 ControllerRunner 与 SpectralRunner 的任务都纳入统一队列 Dock：显示等待/运行/完成状态，允许暂停/取消，完成后可一键打开输出目录或查看日志。
   * 主线程只用来更新 UI，所有计算/绘图/文件保存都在 worker 线程执行，防止界面卡顿。
6. **样式与体验**
   * 采用统一浅色主题（暂不做暗色切换），结合 Qt Stylesheet 提高视觉一致性（统一字体、hover 状态、图标）。
   * 工具栏/菜单分布：文件（打开/导入配置、导出配置）、运行（开始、停止、任务队列）、视图（启用/禁用 docking、重置布局、全屏 viewer）、帮助（文档、日志位置、关于）。
   * 关键操作绑定快捷键：**Ctrl+O** 打开文件、**Ctrl+R** 运行、**Ctrl+Shift+S** 保存配置、**F11** viewer 全屏、**Ctrl+L** 打开日志 Dock。
   * 状态栏显示当前模式、任务状态、提示信息。
7. **实施步骤（建议）**
   1. 搭建 Dock 架构与布局管理（含“简洁模式”开关），调整主窗口结构。
   2. 重写图像 Viewer & 相关 Dock，修复现有全屏/缩放 bug。
   3. 优化 Data/Config/Execute 面板 UI（表单分组、拖拽支持、preset 存储）。
   4. 升级谱分解模式：引入参数 Dock、结果表格、图像 viewer 集成。
   5. 引入任务队列 Dock，统一管理 ControllerRunner 和 SpectralRunner。
   6. 样式/菜单/快捷键统一，添加状态栏提示。
   7. 端到端测试与文档更新。

这样可以确保：默认就有自由调整的 docking 体验；图像 viewer 灵活且能保存多种图形；任务队列避免 GUI 卡死；谱分解面板与后端完全对接，同时保留简洁模式给初学者。
