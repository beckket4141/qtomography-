# å¯†åº¦çŸ©é˜µå¯è§†åŒ–æ–¹æ³•æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“ QTomography ä¸­æ‰€æœ‰æ”¯æŒçš„å¯†åº¦çŸ©é˜µå¯è§†åŒ–æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å’Œç‰¹ç‚¹ã€‚

---

## ğŸ¨ æ”¯æŒçš„å¯è§†åŒ–æ–¹æ³•

### 1. 2Dçƒ­å›¾ï¼ˆHeatmapï¼‰- å®éƒ¨/è™šéƒ¨

**æ–¹æ³•**: `ReconstructionVisualizer.plot_density_heatmap()`

**ä½ç½®**: `python/qtomography/infrastructure/visualization/reconstruction_visualizer.py`

**åŠŸèƒ½**:
- ç»˜åˆ¶å¯†åº¦çŸ©é˜µçš„å®éƒ¨å’Œè™šéƒ¨ä½œä¸º2Dçƒ­å›¾
- ä½¿ç”¨ `imshow()` æ˜¾ç¤ºçŸ©é˜µå…ƒç´ 
- å·¦å³å¹¶æ’æ˜¾ç¤ºå®éƒ¨å’Œè™šéƒ¨

**ç‰¹ç‚¹**:
- âœ… ç›´è§‚æ˜¾ç¤ºçŸ©é˜µç»“æ„
- âœ… é€‚åˆå¿«é€ŸæŸ¥çœ‹çŸ©é˜µæ¨¡å¼
- âœ… å½“å‰é»˜è®¤çš„å­˜å‚¨æ ¼å¼

**ä»£ç ç¤ºä¾‹**:
```python
from qtomography.infrastructure.visualization import ReconstructionVisualizer
from qtomography.domain.density import DensityMatrix

visualizer = ReconstructionVisualizer()
density = DensityMatrix(matrix)

fig = visualizer.plot_density_heatmap(density, title="å¯†åº¦çŸ©é˜µçƒ­å›¾")
fig.savefig("heatmap.png", dpi=150, bbox_inches="tight")
```

**è¾“å‡º**:
- å·¦ä¾§ï¼šå®éƒ¨çƒ­å›¾ï¼ˆReal partï¼‰
- å³ä¾§ï¼šè™šéƒ¨çƒ­å›¾ï¼ˆImag partï¼‰
- ä½¿ç”¨ `RdBu` é¢œè‰²æ˜ å°„
- æ¯ä¸ªå­å›¾éƒ½æœ‰é¢œè‰²æ¡ï¼ˆcolorbarï¼‰

**å½“å‰ä½¿ç”¨**:
- âœ… **é»˜è®¤å­˜å‚¨æ ¼å¼**ï¼š`save_density_heatmap()` ä½¿ç”¨æ­¤æ–¹æ³•
- âœ… GUIä¸­æ˜¾ç¤ºï¼š`FigurePanel._build_heatmap()` ä½¿ç”¨æ­¤æ–¹æ³•

---

### 2. 3DæŸ±çŠ¶å›¾ - å®éƒ¨/è™šéƒ¨

**æ–¹æ³•**: `ReconstructionVisualizer.plot_real_imag_3d()`

**ä½ç½®**: `python/qtomography/infrastructure/visualization/reconstruction_visualizer.py`

**åŠŸèƒ½**:
- ä»¥3DæŸ±çŠ¶å›¾å½¢å¼æ˜¾ç¤ºå¯†åº¦çŸ©é˜µçš„å®éƒ¨å’Œè™šéƒ¨
- ä½¿ç”¨ `bar3d()` ç»˜åˆ¶3DæŸ±çŠ¶å›¾
- å·¦å³å¹¶æ’æ˜¾ç¤ºå®éƒ¨å’Œè™šéƒ¨

**ç‰¹ç‚¹**:
- âœ… 3Då¯è§†åŒ–ï¼Œæ›´ç›´è§‚
- âœ… é€‚åˆæŸ¥çœ‹çŸ©é˜µå…ƒç´ çš„æ•°å€¼å¤§å°
- âœ… å¯ä»¥æ—‹è½¬è§†è§’

**ä»£ç ç¤ºä¾‹**:
```python
fig = visualizer.plot_real_imag_3d(density, title="3Då®éƒ¨è™šéƒ¨")
fig.savefig("real_imag_3d.png", dpi=150, bbox_inches="tight")
```

**è¾“å‡º**:
- å·¦ä¾§ï¼šå®éƒ¨3DæŸ±çŠ¶å›¾ï¼ˆRe(Ï)ï¼‰
- å³ä¾§ï¼šè™šéƒ¨3DæŸ±çŠ¶å›¾ï¼ˆIm(Ï)ï¼‰
- X/Yè½´ï¼šåŸºæ€æ ‡ç­¾ï¼ˆBasis-1, Basis-2, ...ï¼‰
- Zè½´ï¼šçŸ©é˜µå…ƒç´ å€¼

**å½“å‰ä½¿ç”¨**:
- âš ï¸ æœªä½œä¸ºé»˜è®¤å­˜å‚¨æ ¼å¼
- âœ… åœ¨ç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨ï¼š`demo_3d_visualization.py`

---

### 3. 3DæŸ±çŠ¶å›¾ - å¹…åº¦/ç›¸ä½

**æ–¹æ³•**: `ReconstructionVisualizer.plot_amplitude_phase()`

**ä½ç½®**: `python/qtomography/infrastructure/visualization/reconstruction_visualizer.py`

**åŠŸèƒ½**:
- ä»¥3DæŸ±çŠ¶å›¾å½¢å¼æ˜¾ç¤ºå¯†åº¦çŸ©é˜µçš„å¹…åº¦å’Œç›¸ä½
- å¹…åº¦ï¼š`|Ï| = sqrt(ReÂ² + ImÂ²)`
- ç›¸ä½ï¼š`arg(Ï) / Ï€`ï¼ˆä»¥Ï€ä¸ºå•ä½ï¼‰

**ç‰¹ç‚¹**:
- âœ… æ˜¾ç¤ºå¹…åº¦å’Œç›¸ä½ä¿¡æ¯
- âœ… é€‚åˆåˆ†æé‡å­æ€çš„ç›¸ä½å…³ç³»
- âœ… ç›¸ä½é˜ˆå€¼å¤„ç†ï¼ˆå°äº1e-4çš„å…ƒç´ ç›¸ä½è®¾ä¸º0ï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
fig = visualizer.plot_amplitude_phase(density, title="å¹…åº¦ä¸ç›¸ä½")
fig.savefig("amplitude_phase_3d.png", dpi=150, bbox_inches="tight")
```

**è¾“å‡º**:
- å·¦ä¾§ï¼šå¹…åº¦3DæŸ±çŠ¶å›¾ï¼ˆ|Ï|ï¼‰
- å³ä¾§ï¼šç›¸ä½3DæŸ±çŠ¶å›¾ï¼ˆPhase / Ï€ï¼‰
- X/Yè½´ï¼šåŸºæ€æ ‡ç­¾
- Zè½´ï¼šå¹…åº¦å€¼æˆ–ç›¸ä½å€¼ï¼ˆä»¥Ï€ä¸ºå•ä½ï¼‰

**å½“å‰ä½¿ç”¨**:
- âš ï¸ æœªä½œä¸ºé»˜è®¤å­˜å‚¨æ ¼å¼
- âœ… åœ¨ç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨ï¼š`demo_3d_visualization.py`

---

### 4. æŒ‡æ ‡æ›²çº¿å›¾

**æ–¹æ³•**: `ReconstructionVisualizer.plot_metric()`

**ä½ç½®**: `python/qtomography/infrastructure/visualization/reconstruction_visualizer.py`

**åŠŸèƒ½**:
- ç»˜åˆ¶å¤šä¸ªé‡æ„è®°å½•çš„æŸä¸ªæŒ‡æ ‡éšè®°å½•çš„å˜åŒ–æ›²çº¿
- æ”¯æŒä»»æ„æŒ‡æ ‡ï¼ˆå¦‚fidelityã€purityç­‰ï¼‰

**ç‰¹ç‚¹**:
- âœ… é€‚åˆåˆ†æå¤šä¸ªæ ·æœ¬çš„æŒ‡æ ‡å˜åŒ–
- âœ… æ”¯æŒæ—¶é—´åºåˆ—åˆ†æ

**ä»£ç ç¤ºä¾‹**:
```python
records = [record1, record2, record3, ...]
fig = visualizer.plot_metric(records, metric="fidelity", title="ä¿çœŸåº¦å˜åŒ–")
fig.savefig("fidelity_curve.png", dpi=150, bbox_inches="tight")
```

**è¾“å‡º**:
- Xè½´ï¼šè®°å½•ç´¢å¼•æˆ–æ—¶é—´æˆ³
- Yè½´ï¼šæŒ‡æ ‡å€¼
- æŠ˜çº¿å›¾ï¼Œå¸¦æ ‡è®°ç‚¹

**å½“å‰ä½¿ç”¨**:
- âš ï¸ æœªä½œä¸ºé»˜è®¤å­˜å‚¨æ ¼å¼
- âœ… åœ¨ç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨

---

## ğŸ“Š æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | ç»´åº¦ | æ˜¾ç¤ºå†…å®¹ | é€‚ç”¨åœºæ™¯ | å½“å‰é»˜è®¤ |
|------|------|---------|---------|---------|
| `plot_density_heatmap` | 2D | å®éƒ¨/è™šéƒ¨ | å¿«é€ŸæŸ¥çœ‹çŸ©é˜µç»“æ„ | âœ… æ˜¯ |
| `plot_real_imag_3d` | 3D | å®éƒ¨/è™šéƒ¨ | æŸ¥çœ‹æ•°å€¼å¤§å° | âŒ å¦ |
| `plot_amplitude_phase` | 3D | å¹…åº¦/ç›¸ä½ | åˆ†æç›¸ä½å…³ç³» | âŒ å¦ |
| `plot_metric` | 2D | æŒ‡æ ‡æ›²çº¿ | å¤šæ ·æœ¬åˆ†æ | âŒ å¦ |

---

## ğŸ”§ å½“å‰å­˜å‚¨æœºåˆ¶

### å­˜å‚¨ä½ç½®

**å‡½æ•°**: `save_density_heatmap()`

**ä½ç½®**: `python/qtomography/infrastructure/visualization/export.py`

**å½“å‰å®ç°**:
```python
def save_density_heatmap(
    record: ReconstructionRecord,
    path: Path,
    *,
    title: Optional[str] = None,
    dpi: int = 120,
) -> Path:
    density = DensityMatrix(record.density_matrix)
    visualizer = ReconstructionVisualizer()
    figure = visualizer.plot_density_heatmap(density, title=title or default_title)
    figure.savefig(path, dpi=dpi, bbox_inches="tight")
    plt.close(figure)
    return path
```

**è°ƒç”¨ä½ç½®**:
1. **GUIé¢æ¿**: `gui/panels/figure_panel.py` - `load_from_records()`
2. **é‡æ„æµç¨‹**: åœ¨ä¿å­˜ç»“æœæ—¶è‡ªåŠ¨è°ƒç”¨

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

### 1. æ”¯æŒå¤šç§å¯è§†åŒ–æ ¼å¼

**éœ€æ±‚**: å…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„å¯è§†åŒ–æ–¹æ³•

**å®ç°æ–¹æ¡ˆ**:
- åœ¨é…ç½®ä¸­æ·»åŠ  `visualization_method` é€‰é¡¹
- æ”¯æŒï¼š`"heatmap"`, `"real_imag_3d"`, `"amplitude_phase"`, `"all"`
- ä¿®æ”¹ `save_density_heatmap()` æˆ–åˆ›å»ºæ–°çš„ä¿å­˜å‡½æ•°

### 2. æ”¯æŒåŒæ—¶ä¿å­˜å¤šç§æ ¼å¼

**éœ€æ±‚**: ä¸€æ¬¡é‡æ„å¯ä»¥ä¿å­˜å¤šç§å¯è§†åŒ–æ ¼å¼

**å®ç°æ–¹æ¡ˆ**:
- åˆ›å»º `save_all_visualizations()` å‡½æ•°
- ä¸ºæ¯ç§æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„å›¾ç‰‡æ–‡ä»¶
- æ–‡ä»¶å‘½åï¼š`{base_name}_heatmap.png`, `{base_name}_3d_real_imag.png`, ç­‰

### 3. è‡ªå®šä¹‰å¯è§†åŒ–å‚æ•°

**éœ€æ±‚**: å…è®¸ç”¨æˆ·è‡ªå®šä¹‰é¢œè‰²æ˜ å°„ã€å›¾ä¾‹ã€æ ‡é¢˜ç­‰

**å®ç°æ–¹æ¡ˆ**:
- åœ¨å¯è§†åŒ–æ–¹æ³•ä¸­æ·»åŠ å‚æ•°
- æ”¯æŒé…ç½®ï¼š`cmap`, `figsize`, `dpi`, `title_format` ç­‰

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒå®ç°
- **å¯è§†åŒ–å™¨**: `python/qtomography/infrastructure/visualization/reconstruction_visualizer.py`
- **å¯¼å‡ºå‡½æ•°**: `python/qtomography/infrastructure/visualization/export.py`
- **GUIæ˜¾ç¤º**: `python/qtomography/gui/panels/figure_panel.py`

### ç¤ºä¾‹ä»£ç 
- **3Då¯è§†åŒ–æ¼”ç¤º**: `python/examples/demo_3d_visualization.py`
- **å®Œæ•´æ¼”ç¤º**: `python/demo_full_reconstruction.py`

### æµ‹è¯•
- **å•å…ƒæµ‹è¯•**: `python/tests/unit/test_visualization.py`

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¯è§†åŒ–3Då¢å¼ºè¯´æ˜](implemented/visualization-3d-enhancement.md)
- [é‡æ„ç»“æœæŒä¹…åŒ–](persistence/result_repository.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-07  
**é€‚ç”¨ä»“åº“**: QTomography (æœ¬ä»“åº“)

